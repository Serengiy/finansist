import{r as S,A as $,o as a,s as n,a as w,w as k,F as d,v as _,t as m,l,x as z,b as h,c as P,q as L,n as G,P as I,N as T}from"./app-1a3ff893.js";import{a as H,Q as J}from"./QTable-1b87373b.js";import{Q as K}from"./QPagination-9d6da5e4.js";const W={key:0,class:"shadow-3"},X={key:0},Y={class:"text-primary"},Z={key:0},ee={key:5},ae={class:"row bg-white justify-center q-pb-md rounded-borders"},te={key:1,class:"row q-mt-sm bg-white justify-center q-pb-md rounded-borders shadow-3"},se={__name:"OperationTable",props:{operations:Array,pagination:Object},emits:["update:pagination","refresh"],setup(i,{emit:U}){const D=i,E=S([{name:"sber_amountRub",label:"Сумма",field:"sber_amountRub",align:"left",sortable:!0,sort:(t,o)=>parseInt(t,10)-parseInt(o,10)},{name:"categories",label:"Категория",field:"categories",align:"left",sortable:!0,sort:(t,o,r,e)=>{var c,u,y,f;const b=((u=(c=r.categories)==null?void 0:c[0])==null?void 0:u.name)||"",g=((f=(y=e.categories)==null?void 0:y[0])==null?void 0:f.name)||"";return b.localeCompare(g)}},{name:"contractor",label:"Контрагент",field:"payee_contractor",align:"left",sortable:!0,sort:(t,o,r,e)=>{var c,u;const b=((c=r.payee_contractor)==null?void 0:c.full_name)||"",g=((u=e.payee_contractor)==null?void 0:u.full_name)||"";return b.localeCompare(g)}},{name:"is_manual",label:"is manual",field:"is_manual",align:"left",sortable:!0,sort:(t,o)=>Number(t)-Number(o)},{name:"direction",label:"Направление",field:"direction",sortable:!0},{name:"actions",label:"Действия",align:"left"},{name:"date_at",label:"Дата",field:"date_at",align:"left",sortable:!0,sort:(t,o)=>new Date(t)-new Date(o)},{name:"sber_paymentPurpose",label:"Назначение",field:"sber_paymentPurpose",align:"left"}]),O=U,F=t=>{O("update:pagination",{...D.pagination,page:t})},M=async t=>{var o;I.show();try{const r=await axios.put(`/api/operations/${t==null?void 0:t.id}`,{is_manual:t.is_manual});(o=r==null?void 0:r.data)!=null&&o.success&&T.create({message:"Обновлено",color:"green",timeout:2e3})}catch{T.create({message:"Ошибка обновления",color:"red",timeout:2e3})}I.hide()};return(t,o)=>{const r=$("router-link");return i.operations.length?(a(),n("div",W,[w(J,{flat:"",class:"q-mt-md q-px-sm",rows:i.operations,pagination:{rowsPerPage:i.pagination.rowsPerPage},columns:E.value,"row-key":"id","hide-bottom":""},{"body-cell":k(e=>[w(H,{item:e},{default:k(()=>{var b,g,c,u,y,f,v,C,N,V,q,Q,B,R,j,A;return[e.col.name==="sber_amountRub"?(a(),n(d,{key:0},[_(m((b=e.row)==null?void 0:b.sber_amountRub),1)],64)):l("",!0),e.col.name==="categories"?(a(),n(d,{key:1},[((g=e.row)==null?void 0:g.categories.length)>1?(a(),n("span",X,[(a(!0),n(d,null,z(e.row.categories,(s,p)=>(a(),n("span",null,[_(m(s.name)+" ",1),h("span",Y," ("+m(s.sber_amountRub)+") ",1),p<e.row.categories.length-1?(a(),n("span",Z,", ")):l("",!0)]))),256))])):(a(),n(d,{key:1},[(y=(u=(c=e.row)==null?void 0:c.categories)==null?void 0:u[0])!=null&&y.id?(a(),P(r,{key:0,to:{name:"CategoriesEdit",params:{id:(C=(v=(f=e.row)==null?void 0:f.categories)==null?void 0:v[0])==null?void 0:C.id}},target:"_blank"},{default:k(()=>{var s,p;return[_(m((p=(s=e.row)==null?void 0:s.categories)==null?void 0:p.map(x=>x==null?void 0:x.name).join(", ")),1)]}),_:2},1032,["to"])):l("",!0)],64))],64)):l("",!0),e.col.name==="contractor"?(a(),n(d,{key:2},[(V=(N=e.row)==null?void 0:N.payee_contractor)!=null&&V.id?(a(),P(r,{key:0,to:{name:"ContractorShow",params:{id:(Q=(q=e.row)==null?void 0:q.payee_contractor)==null?void 0:Q.id}},target:"_blank"},{default:k(()=>{var s,p;return[h("div",null,m((p=(s=e.row)==null?void 0:s.payee_contractor)==null?void 0:p.full_name),1)]}),_:2},1032,["to"])):l("",!0)],64)):l("",!0),e.col.name==="is_manual"?(a(),P(L,{key:3,"onUpdate:modelValue":[s=>e.row.is_manual=s,s=>M(e.row)],"model-value":e.row.is_manual},null,8,["onUpdate:modelValue","model-value"])):l("",!0),e.col.name==="direction"?(a(),n(d,{key:4},[_(m((B=e.row)==null?void 0:B.direction),1)],64)):l("",!0),e.col.name==="actions"?(a(),n("div",ee,[w(r,{to:{name:"OperationEdit",params:{id:(R=e==null?void 0:e.row)==null?void 0:R.id}},class:"cursor-pointer"},{default:k(()=>[w(G,{color:"primary",size:"xs",name:"edit",class:"cursor-pointer"})]),_:2},1032,["to"])])):l("",!0),e.col.name==="date_at"?(a(),n(d,{key:6},[_(m((j=e.row)==null?void 0:j.date_at),1)],64)):l("",!0),e.col.name==="sber_paymentPurpose"?(a(),n(d,{key:7},[_(m((A=e.row)==null?void 0:A.sber_paymentPurpose),1)],64)):l("",!0)]}),_:2},1032,["item"])]),_:1},8,["rows","pagination","columns"]),h("div",ae,[w(K,{modelValue:i.pagination.page,"onUpdate:modelValue":[o[0]||(o[0]=e=>i.pagination.page=e),F],max:Math.ceil(i.pagination.rowsNumber/i.pagination.rowsPerPage),"boundary-numbers":"","boundary-links":"","max-pages":10,class:"text-center q-mt-md"},null,8,["modelValue","max"])])])):(a(),n("div",te,o[1]||(o[1]=[h("p",{class:"text-h6"}," Для этого контрагента операции не найдены ",-1)])))}}};export{se as _};
