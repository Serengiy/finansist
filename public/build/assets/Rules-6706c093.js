import{u as F,r as k,s as I,o as s,p as r,a as l,w as y,F as p,q as f,t as g,l as u,a1 as w,b as c,N as b,k as M,c as O,O as S}from"./app-02de39f9.js";import{Q as A}from"./QPage-f839adb7.js";import{a as D,Q as G}from"./QTable-8de77412.js";import{Q as H}from"./QPagination-a62e05f7.js";import"./QSelect-4c4a6120.js";const J={key:0,class:"rounded-borders shadow-3"},K={key:3,class:"row justify-between"},L={class:"row bg-white justify-center q-pb-md"},W={key:1},X={__name:"RulesTable",props:{rules:Array,pagination:Object},emits:["update:pagination","refresh"],setup(n,{emit:h}){F();const _=n,d=h,x=k([{name:"category",label:"Категория",field:e=>{var t;return(t=e==null?void 0:e.category)==null?void 0:t.name},align:"left"},{name:"contractor",label:"Контрагент",field:e=>{var t;return(t=e==null?void 0:e.contractor)==null?void 0:t.full_name},align:"left"},{name:"purpose_expression",label:"Регулярное выражение",field:"purpose_expression",align:"left"},{name:"actions",label:"Действия",align:"left"}]),m=async e=>{var t;try{const o=await axios.delete(`/api/rules/${e}`);(t=o==null?void 0:o.data)!=null&&t.success&&(b.create({message:"Правило успешно удалено",color:"green",timeout:2e3}),d("refresh"))}catch{b.create({message:"Ошибка удаления",color:"red",timeout:2e3})}},i=e=>{d("update:pagination",{..._.pagination,page:e})};return(e,t)=>{var v;const o=I("router-link");return s(),r("div",null,[n.rules.length?(s(),r("div",J,[l(G,{class:"q-mt-md q-px-sm",rows:n.rules,pagination:{rowsPerPage:(v=n.pagination)==null?void 0:v.rowsPerPage},columns:x.value,"row-key":"id","hide-bottom":"",flat:""},{"body-cell":y(a=>[l(D,{item:a},{default:y(()=>{var P,q,C,N,Q,R,V,$,j,B,T,z,U,E;return[a.col.name==="purpose_expression"?(s(),r(p,{key:0},[f(g((P=a.row)==null?void 0:P.purpose_expression),1)],64)):u("",!0),a.col.name==="category"?(s(),r(p,{key:1},[f(g((C=(q=a.row)==null?void 0:q.category)==null?void 0:C.name)+" "+g((Q=(N=a.row)==null?void 0:N.category)==null?void 0:Q.id),1)],64)):u("",!0),a.col.name==="contractor"?(s(),r(p,{key:2},[(V=(R=a.row)==null?void 0:R.contractor)!=null&&V.name?u("",!0):(s(),r(p,{key:0},[f(" Для всех ")],64)),(j=($=a.row)==null?void 0:$.contractor)!=null&&j.full_name?(s(),r(p,{key:1},[f(g((T=(B=a.row)==null?void 0:B.contractor)==null?void 0:T.full_name)+" "+g((U=(z=a.row)==null?void 0:z.contractor)==null?void 0:U.id),1)],64)):u("",!0)],64)):u("",!0),a.col.name==="actions"?(s(),r("div",K,[l(o,{class:"q-mr-sm",to:{name:"EditRule",params:{id:(E=a==null?void 0:a.row)==null?void 0:E.id}}},{default:y(()=>[l(w,{name:"edit",size:"xs",class:"cursor-pointer",color:"primary"})]),_:2},1032,["to"]),l(w,{onClick:te=>m(a.row.id),name:"delete",size:"xs",class:"cursor-pointer",color:"negative"},null,8,["onClick"])])):u("",!0)]}),_:2},1032,["item"])]),_:1},8,["rows","pagination","columns"]),c("div",L,[l(H,{modelValue:n.pagination.page,"onUpdate:modelValue":[t[0]||(t[0]=a=>n.pagination.page=a),i],max:Math.ceil(n.pagination.rowsNumber/n.pagination.rowsPerPage),"boundary-numbers":"","boundary-links":"","max-pages":10,class:"text-center q-mt-md"},null,8,["modelValue","max"])])])):(s(),r("div",W,t[1]||(t[1]=[c("p",{class:"text-h6 text-center"}," Для этого контрагента правила не установлены ",-1)])))])}}},Y={class:"row justify-center"},Z={class:"justify-center col-12 q-px-md q-mt-lg"},ee={class:"text-blue-5 row items-center"},ae=["onClick"],ce={__name:"Rules",setup(n){const _=F().params.id,d=k([]),x=k({page:1,rowsPerPage:20,rowsNumber:0}),m=async()=>{try{const i=await axios.get("/api/rules",{params:{contractor_id:_,load:["category,contractor"]}});console.log(i.data.data),d.value=i.data.data}catch{b.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}};return M(()=>{m()}),(i,e)=>{const t=I("router-link");return s(),O(A,{class:"bg-grey-3"},{default:y(()=>[c("div",Y,[c("div",Z,[c("p",ee,[l(t,{to:{name:"ContractorShow",params:{id:S(_)}},custom:""},{default:y(({navigate:o})=>[c("div",{onClick:o,class:"cursor-pointer"},[l(w,{size:"sm",name:"keyboard_arrow_left"}),e[1]||(e[1]=f(" Назад "))],8,ae)]),_:1},8,["to"])]),e[2]||(e[2]=c("p",{class:"text-h6 text-center"}," Правила ",-1)),l(X,{rules:d.value,pagination:x.value,"onUpdate:pagination":e[0]||(e[0]=o=>{x.value=o,m()}),onRefresh:m},null,8,["rules","pagination"])])])]),_:1})}}};export{ce as default};
