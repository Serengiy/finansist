import{u as _,r as i,j as Q,k as h,o as k,c as C,w as P,N as m,b as s,q,a as o,f as p,x as N,e as n,P as w}from"./app-90bf6a79.js";import{Q as T}from"./QPage-3662eeea.js";import{_ as U}from"./OperationTable-335037bf.js";import"./QTable-ca0f14f3.js";import"./QSelect-4ea1f147.js";import"./QPagination-de6aaaf7.js";const A={class:"row justify-center"},F={class:"row justify-center col-12 q-px-md q-pt-lg q-mb-sm"},I={class:"col-3 bg-accent bg-white shadow-24 q-pa-sm rounded-borders mb"},B={class:"row"},j={class:"text-body2 q-mt-md"},z={class:"text-body2 q-mt-md"},O={class:"col-9 bg-grey-3 q-px-sm"},R={class:"bg-white shadow-3 q-px-sm rounded-borders q-pb-md"},$={class:"row"},M={class:"row q-mt-sm"},D={class:"row q-mt-sm q-ml-sm"},X={__name:"Operations",setup(E){const c=_().params.id,g=i([]),v=i(!1),l=i({page:1,rowsPerPage:20,rowsNumber:0}),a=i({purposeQuery:"",categoryQuery:"",dateAt:null,dateFrom:null,dateTo:null,payeeContractorIds:[]});Q(a,()=>{l.value.page=1},{deep:!0});const u=async()=>{var r,e,t,y,b,f,x;try{const d=await axios.get("/api/operations",{params:{payeeContractorId:c,paginate:l.value.rowsPerPage,page:l.value.page,dateAt:a.value.dateAt,dateTo:a.value.dateTo,dateFrom:a.value.dateFrom,purposeQuery:a.value.purposeQuery,categoryQuery:a.value.categoryQuery}});g.value=(r=d==null?void 0:d.data)==null?void 0:r.data,l.value.rowsNumber=(t=(e=d.data)==null?void 0:e.meta)==null?void 0:t.total,l.value.page=(b=(y=d.data)==null?void 0:y.meta)==null?void 0:b.current_page,l.value.totalPages=(x=(f=d.data)==null?void 0:f.meta)==null?void 0:x.last_page}catch{m.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}},V=async()=>{w.show(),v.value=!0;try{const r=await axios.get(`/api/contractors/${c}/check`);r.data.success?m.create({message:r.data.message,color:"green",timeout:2e3}):m.create({message:"Ошибка проверки",color:"red",timeout:2e3})}catch{m.create({message:"Ошибка проверки",color:"red",timeout:2e3})}v.value=!1,w.hide()};return h(()=>{u()}),(r,e)=>(k(),C(T,{class:"bg-grey-3"},{default:P(()=>[s("div",A,[s("div",F,[s("div",I,[s("div",B,[e[8]||(e[8]=s("span",{class:"text-h6 text-center"}," Действия ",-1)),s("span",j,[e[6]||(e[6]=q(" Проверить все операции контрагента: ")),o(p,{class:"q-ml-sm",dense:"",size:"sm",onClick:V,label:"проверить",color:"primary"})]),s("span",z,[e[7]||(e[7]=q(" Создать новую операцию: ")),o(p,{class:"q-ml-sm",dense:"",size:"sm",to:{name:"OperationCreate",params:{contractorId:N(c)}},label:"создать",color:"primary"},null,8,["to"])])])]),s("div",O,[s("div",R,[e[9]||(e[9]=s("p",{class:"text-h6 text-center"}," Операции контрагента ",-1)),s("div",$,[o(n,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:a.value.dateAt,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.dateAt=t),label:"Дата",type:"date"},null,8,["modelValue"]),o(n,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:a.value.categoryQuery,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.categoryQuery=t),label:"Категории"},null,8,["modelValue"]),o(n,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:a.value.purposeQuery,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.purposeQuery=t),label:"Назначение"},null,8,["modelValue"])]),s("div",M,[o(n,{class:"col-2 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:a.value.dateFrom,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.dateFrom=t),label:"Дата начала",type:"date"},null,8,["modelValue"]),o(n,{class:"col-2 q-px-sm",dense:"",clearable:"",outlined:"",filled:"",modelValue:a.value.dateTo,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.dateTo=t),label:"Дата окончания",type:"date"},null,8,["modelValue"])]),s("div",D,[o(p,{class:"text-right",dense:"",size:"sm",onClick:u,label:"Применить фильтры",color:"primary"})])]),o(U,{operations:g.value,pagination:l.value,"onUpdate:pagination":e[5]||(e[5]=t=>{l.value=t,u()}),onRefresh:u},null,8,["operations","pagination"])])])])]),_:1}))}};export{X as default};
