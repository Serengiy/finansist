import{u as k,r as n,j as C,k as P,o as N,c as T,w as U,N as u,b as a,t as _,q,a as l,f as g,O as A,e as i,P as h}from"./app-868719fb.js";import{Q as F}from"./QPage-967866e9.js";import{_ as I}from"./OperationTable-2fc29d7e.js";import"./QTable-c076b676.js";import"./QSelect-549536ce.js";import"./QPagination-2fa34b7f.js";const j={class:"row justify-center"},B={class:"row justify-center col-12 q-px-md q-pt-lg q-mb-sm"},O={class:"col-12 bg-white shadow-24 q-pa-sm rounded-borders q-mb-md"},z={class:"row"},R={class:"col-12 text-h6"},$={class:"col-12 text-h6"},D={class:"col-3 bg-accent bg-white shadow-24 q-pa-sm rounded-borders mb"},M={class:"row"},S={class:"text-body2 q-mt-md"},E={class:"text-body2 q-mt-md"},G={class:"col-9 bg-grey-3 q-px-sm"},H={class:"bg-white shadow-3 q-px-sm rounded-borders q-pb-md"},J={class:"row"},K={class:"row q-mt-sm"},L={class:"row q-mt-sm q-ml-sm"},oe={__name:"Operations",setup(W){const c=k().params.id,v=n([]),y=n(!1),p=n({}),r=n({page:1,rowsPerPage:20,rowsNumber:0}),t=n({purposeQuery:"",categoryQuery:"",dateAt:null,dateFrom:null,dateTo:null,payeeContractorIds:[]});C(t,()=>{r.value.page=1},{deep:!0});const m=async()=>{var o,e,s,b,f,w,x;try{const d=await axios.get("/api/operations",{params:{payeeContractorId:c,paginate:r.value.rowsPerPage,page:r.value.page,dateAt:t.value.dateAt,dateTo:t.value.dateTo,dateFrom:t.value.dateFrom,purposeQuery:t.value.purposeQuery,categoryQuery:t.value.categoryQuery}});v.value=(o=d==null?void 0:d.data)==null?void 0:o.data,r.value.rowsNumber=(s=(e=d.data)==null?void 0:e.meta)==null?void 0:s.total,r.value.page=(f=(b=d.data)==null?void 0:b.meta)==null?void 0:f.current_page,r.value.totalPages=(x=(w=d.data)==null?void 0:w.meta)==null?void 0:x.last_page}catch{u.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}},V=async()=>{try{const o=await axios.get("/api/contractors/"+c);p.value=o.data.data}catch{u.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}},Q=async()=>{h.show(),y.value=!0;try{const o=await axios.get(`/api/contractors/${c}/check`);o.data.success?u.create({message:o.data.message,color:"green",timeout:2e3}):u.create({message:"Ошибка проверки",color:"red",timeout:2e3})}catch{u.create({message:"Ошибка проверки",color:"red",timeout:2e3})}y.value=!1,h.hide()};return P(()=>{V(),m()}),(o,e)=>(N(),T(F,{class:"bg-grey-3"},{default:U(()=>[a("div",j,[a("div",B,[a("div",O,[e[6]||(e[6]=a("div",{class:"row justify-center"},[a("span",{class:"text-h6"}," Информация о контрагенте ")],-1)),a("div",z,[a("div",R," Имя контрагента: "+_(p.value.full_name),1),a("div",$," ИНН контрагента: "+_(p.value.inn_kpp),1)])]),a("div",D,[a("div",M,[e[9]||(e[9]=a("span",{class:"text-h6 text-center"}," Действия ",-1)),a("span",S,[e[7]||(e[7]=q(" Проверить все операции контрагента: ")),l(g,{class:"q-ml-sm",dense:"",size:"sm",onClick:Q,label:"проверить",color:"primary"})]),a("span",E,[e[8]||(e[8]=q(" Создать новую операцию: ")),l(g,{class:"q-ml-sm",dense:"",size:"sm",to:{name:"OperationCreate",params:{contractorId:A(c)}},label:"создать",color:"primary"},null,8,["to"])])])]),a("div",G,[a("div",H,[e[10]||(e[10]=a("p",{class:"text-h6 text-center"}," Операции контрагента ",-1)),a("div",J,[l(i,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:t.value.dateAt,"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.dateAt=s),label:"Дата",type:"date"},null,8,["modelValue"]),l(i,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:t.value.categoryQuery,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.categoryQuery=s),label:"Категории"},null,8,["modelValue"]),l(i,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:t.value.purposeQuery,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.purposeQuery=s),label:"Назначение"},null,8,["modelValue"])]),a("div",K,[l(i,{class:"col-2 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:t.value.dateFrom,"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.dateFrom=s),label:"Дата начала",type:"date"},null,8,["modelValue"]),l(i,{class:"col-2 q-px-sm",dense:"",clearable:"",outlined:"",filled:"",modelValue:t.value.dateTo,"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.dateTo=s),label:"Дата окончания",type:"date"},null,8,["modelValue"])]),a("div",L,[l(g,{class:"text-right",dense:"",size:"sm",onClick:m,label:"Применить фильтры",color:"primary"})])]),l(I,{operations:v.value,pagination:r.value,"onUpdate:pagination":e[5]||(e[5]=s=>{r.value=s,m()}),onRefresh:m},null,8,["operations","pagination"])])])])]),_:1}))}};export{oe as default};
