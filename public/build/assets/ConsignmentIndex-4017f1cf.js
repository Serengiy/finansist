import{Q as S}from"./QSpace-767f85f1.js";import{r as i,o as t,c as $,w as n,u as R,Q as T,a as s,d as y,t as _,s as z,i as x,j as F,h as K,k as j,x as E,y as L,z as U,L as A,B as J,C as G,n as l,F as v,q as c,b as M,H as W,v as q,I as P,J as X,P as w,N}from"./app-64dafc3a.js";import{Q as Y,a as Z}from"./QTable-9f10ca35.js";import{Q as B}from"./QPagination-9c29fd07.js";import{Q as ee}from"./QForm-db958e76.js";import{C as se}from"./ClosePopup-9fac0edc.js";import{u as I}from"./use-dialog-plugin-component-00e1baf8.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";import"./QSelect-fcdeceb1.js";import"./QChip-18101fab.js";import"./position-engine-f936ecea.js";const oe={class:"text-center"},te={class:"text-center q-mt-lg"},ne={__name:"ConsignmentDialog",props:["id","note"],emits:[...I.emits],setup(C){i();const g=C,{dialogRef:p,onDialogHide:d,onDialogOK:b,onDialogCancel:k}=I();function u(){b({id:g.id})}return(r,Q)=>(t(),$(T,{ref_key:"dialogRef",ref:p,onHide:R(d)},{default:n(()=>[s(j,{class:"dialog q-pa-lg"},{default:n(()=>[y("h5",oe,_(g.note),1),s(ee,{onSubmit:u},{default:n(()=>[s(z,{inset:""}),y("div",te,[s(x,{class:"q-mr-sm",color:"green",label:"OK",type:"submit",unelevated:""}),F(s(x,{class:"q-ml-sm",color:"red",label:"Отмена",unelevated:""},null,512),[[se]])]),s(K,{class:"justify-center"},{default:n(()=>[s(S)]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}},le=ae(ne,[["__scopeId","data-v-53723e1c"]]),re={key:3},ie={key:4},ce={class:"flex flex-center"},de={class:"flex flex-center"},he={__name:"ConsignmentIndex",setup(C){E();const g=L();U("auth");const p=i(!1),d=i(),b=i({consignment_id:null}),k=async a=>{w.show();try{const o=await axios.get("/api/consignments",{params:{...b.value,page:a}});d.value=o.data.data,r.value=o.data.current_page,u.value=o.data.last_page}catch(o){console.error(o)}w.hide()};A(()=>{g.name==="ConsignmentsIndex"&&k()});const u=i(0),r=i(0);i({}),J(r,a=>{k(a)});const Q={rowsNumber:50},H=async(a,o)=>{X.create({component:le,componentProps:{id:a,note:`Вы уверены что хотите сформировать отгрузку ${o}?`}}).onOk(async h=>{p.value=!0,w.show();try{(await axios.post(`/api/consignments/${h.id}`)).data.success?N.create({message:"Отгрузка сформирована",color:"green"}):N.create({message:"Ошибка формирования отгрузки",color:"red"}),setTimeout(()=>{window.location.href="/consignments"},2e3)}catch(m){console.log(m)}w.hide()})},O=[{label:"Склад",name:"storage_city",field:"storage_city",sortable:!1,align:"left"},{label:"Магазины",name:"shops",field:a=>a.reserves,sortable:!1,align:"left"},{label:"Кол-во товаров",name:"orders_count",field:a=>a.reserves,sortable:!1,align:"left"},{label:"Дата отгрузки",name:"due_date",field:a=>a.reserves,sortable:!1,align:"left"},{label:"Сформировать",name:"pack",align:"left"}];return(a,o)=>{var m;const h=G("router-link");return t(),l(v,null,[s(j,null,{default:n(()=>[s(M,{class:"row q-gutter-sm justify-between items-start"},{default:n(()=>[s(S)]),_:1})]),_:1}),(m=d.value)!=null&&m.length?(t(),l(v,{key:0},[s(Y,{columns:O,pagination:Q,rows:d.value,dense:"","hide-bottom":"","row-key":"id",title:"Характеристики","virtual-scroll":"","wrap-cells":""},{"body-cell":n(e=>[s(Z,{class:W(e.row.is_wrong?"bg-red-2":e.row.is_validated?"bg-green-2":""),item:e},{default:n(()=>{var D;return[e.col.name==="storage_city"?(t(),$(h,{key:0,to:{name:"ConsignmentsCourierShow",params:{consignmentId:e.row.consignment_id,taskId:"1"}}},{default:n(()=>[q(_(e.row.storage_city),1)]),_:2},1032,["to"])):c("",!0),e.col.name==="shops"?(t(!0),l(v,{key:1},P(e.row.reserves,f=>(t(),l("div",null,_(f.shop),1))),256)):c("",!0),e.col.name==="orders_count"?(t(!0),l(v,{key:2},P(e.row.reserves,f=>(t(),l("div",null,_(f.orders_count),1))),256)):c("",!0),e.col.name==="due_date"?(t(),l("div",re,_((D=e.row.reserves[0])==null?void 0:D.due_date),1)):c("",!0),e.col.name==="pack"&&e.row.status!=="completed"&&e.row.status!=="transferred_for_delivery"?(t(),l("div",ie,[s(x,{disabled:p.value,class:"text-white q-my-sm",color:"teal-7",size:"sm",onClick:f=>{var V;return H(e.row.consignment_id,(V=e.row.reserves[0])==null?void 0:V.due_date)}},{default:n(()=>[q(" Сформировать ")]),_:2},1032,["disabled","onClick"])])):c("",!0)]}),_:2},1032,["class","item"])]),_:1},8,["rows"]),y("div",ce,[s(B,{modelValue:r.value,"onUpdate:modelValue":o[0]||(o[0]=e=>r.value=e),max:u.value,"max-pages":6,"boundary-links":"","boundary-numbers":"",class:"q-mt-md","direction-links":""},null,8,["modelValue","max"])]),y("div",de,[s(B,{modelValue:r.value,"onUpdate:modelValue":o[1]||(o[1]=e=>r.value=e),"boundary-links":!1,"direction-links":!1,max:u.value,"max-pages":6,class:"q-mt-md",input:""},null,8,["modelValue","max"])])],64)):c("",!0)],64)}}};export{he as default};
