import{y as se,x as le,r as f,z as te,L as oe,B as ae,o,n as c,d as e,t as p,q as i,v as d,a as u,w as v,i as x,F as _,I as G,c as I,ah as re,P as k,N as ce,J,g as q,s as ie}from"./app-64dafc3a.js";import{a as W,Q as A}from"./QTable-9f10ca35.js";import{Q as ne}from"./QSlideTransition-5ec42607.js";import{Q as S}from"./QFile-eeadd18b.js";import{_ as de}from"./ImageDialog-5fc91dda.js";import{_ as ue}from"./ImageCarouselDialog-dda6426c.js";import"./QSelect-fcdeceb1.js";import"./QChip-18101fab.js";import"./position-engine-f936ecea.js";import"./QTooltip-3ff6951b.js";import"./QImg-4607bda3.js";import"./ClosePopup-9fac0edc.js";import"./use-dialog-plugin-component-00e1baf8.js";import"./use-render-cache-f6c711e0.js";const pe={class:"row justify-center"},_e={key:0,class:"q-pa-lg q-mb-xl text-red"},ve={key:0,class:"q-pa-lg q-mb-xl"},me={class:"row justify-center"},he={class:"col-sm-9"},ge={class:"order-details"},fe={class:"row"},ye={class:"col-12 text-h5"},ke=e("b",null,"Номер заказа: ",-1),we={class:"col-12 text-h5"},be=e("b",null,"ID заказа: ",-1),xe={class:"row text-center q-mt-lg"},qe={class:"col-12 text-h6"},ze={key:0},je={class:"q-mt-lg"},Ce={class:"row col-12"},$e=e("div",null,[e("p",null,[e("b",null,"Другие заказы этого резерва: ")])],-1),Ve={class:"q-ml-lg"},Ie=e("div",{class:"row text-center q-mt-lg"},[e("div",{class:"col-12 text-h6"}," Сборка заказа")],-1),Se={class:"row justify-center col-12"},Qe={class:"row q-mt-lg"},Oe=["onClick"],Ue=["src"],Pe={class:"row col-12 q-mt-lg justify-center"},Be={class:"row col-9 q-mt-lg"},Ne={class:"col-12 text-center"},Te={key:0,class:"row justify-center col-12 q-mt-lg"},De=e("div",{class:"col-xs-3 col-sm-3"},[e("p",null,[e("b",null,"Фото товара:")])],-1),Fe={class:"col-xs-9 col-sm-6"},Le={class:"col-xs-12 col-sm-3 q-mt-sm-sm"},Re={key:0,class:"row justify-center"},Ee=["src"],Ge={key:1,class:"row justify-center"},Je=["src"],We={key:1,class:"row justify-center col-12 q-mt-lg"},Ae=e("div",{class:"col-xs-3 col-sm-3"},[e("p",null,[e("b",null,"Фото бирки:")])],-1),He={class:"col-xs-9 col-sm-6"},Ke={class:"col-xs-12 col-sm-3 q-mt-sm-sm"},Me={key:0,class:"row justify-center"},Xe=["src"],Ye={key:1,class:"row justify-center"},Ze=["src"],es={key:0,class:"row col-12 justify-center q-mt-lg"},ss={class:"text-h6"},ls={class:"col-12 text-center q-mt-sm"},ts={key:2,class:"row justify-center col-12 q-mt-lg"},os=e("div",{class:"col-xs-3 col-sm-3"},[e("p",null,[e("b",null,"Фото собранного товара:")])],-1),as={class:"col-xs-9 col-sm-6"},rs={class:"col-xs-12 col-sm-3 q-mt-sm-sm"},cs={key:0,class:"row justify-center"},is=["src"],ns={key:1,class:"row justify-center"},ds=["src"],us={key:3,class:"row justify-center col-12 q-mt-lg"},ps=e("div",{class:"col-xs-5 col-sm-3"},[e("p",null,[e("b",null,"Комплектующие:")])],-1),_s={class:"col-xs-7 col-sm-9"},vs={key:4,class:"row col-9 justify-center q-mt-lg"},ms={key:1,class:"q-pa-lg"},hs={class:"text-center"},gs=e("h3",null,"Заказ собран.",-1),Os={__name:"ShowOzon",setup(fs){const Q=se();le();const a=f(),z=f(),w=f(!1),O=f(null),g=te("user"),j=Q.params.orderId,C=f(),$=f(),r=f({product_pic:null,product_label:null,product_package:null,responsible:null,components:[]}),H=async()=>{k.show();try{const s=await(await axios.get(`/api/orders/${j}/ozon`)).data;if(s.canceled){C.value=s.canceled,k.hide();return}a.value=s.order,a.value.is_found=K(a.value.status),O.value=s.components,$.value=s.images}catch(l){console.error(l)}k.hide()},K=l=>l==="found"||l==="awaiting_delivery",M=()=>{var l,s,n;try{axios.post(`/api/orders/user/${(l=g==null?void 0:g.value)==null?void 0:l.id}/accept-order/${j}/ozon`,{tg_id:(s=g.value)==null?void 0:s.tg_id,fi:(n=g.value)==null?void 0:n.fi}),a.value.is_found=!0}catch(b){console.log(b)}},U=async l=>{var s;l&&(r.value.submit=!0),k.show();try{r.value.responsible=(s=g==null?void 0:g.value)==null?void 0:s.id;const n=await axios.post(`/api/orders/${j}`,{supply:r.value},{responseType:"arraybuffer",headers:{"Content-Type":"multipart/form-data"}});n.status===201?(z.value=a.value.id,a.value=null,r.value=null):n.status===200||ce.create({message:"Не удалось сохранить товар",color:"red"}),k.hide()}catch(n){console.log(n)}k.hide()},X=()=>{try{r.value.is_sticker_printed=!0}catch(l){console.log(l)}};oe(()=>{Q.name==="OrderShowOzon"&&H()});const m=l=>l instanceof File?URL.createObjectURL(l):typeof l=="string"?l:null,V=l=>{a.value.images[l]=null},y=l=>{console.log(l),J.create({component:de,componentProps:{imageUrl:l}})},Y=l=>{J.create({component:ue,componentProps:{images:$.value,currentIndex:l}})};ae(()=>{var l,s,n;return[(l=r.value)==null?void 0:l.product_pic,(s=r.value)==null?void 0:s.product_label,(n=r.value)==null?void 0:n.product_package]},async([l,s,n])=>{(l||s||n)&&await U()});const Z=[{label:"Название",name:"name",field:l=>l.product.name,sortable:!1,align:"left",headerStyle:"width: 40%;font-size: 0.9rem;"},{label:"Магазин",name:"shop",field:l=>l.reserve.shop,sortable:!1,align:"left",headerStyle:"width: 20%;font-size: 0.9rem;"},{label:"Маркетплейс",name:"marketplace",field:l=>l.reserve.marketplace,sortable:!1,align:"left",headerStyle:"width: 20%;font-size: 0.9rem;"},{label:"Цена заказа",name:"price",field:"price",sortable:!1,align:"left",headerStyle:"width: 20%;font-size: 0.9rem;"}],ee=[{label:"Дата отгрузки",name:"reserve_id",field:"price",sortable:!1,align:"left",headerStyle:"width: 40%;font-size: 0.9rem;"},{label:"Цвет",name:"color",field:l=>l.product.name,sortable:!1,align:"left",headerStyle:"width: 20%;font-size: 0.9rem;"},{label:"Размер",name:"size",field:l=>l.reserve.shop,sortable:!1,align:"left",headerStyle:"width: 20%;font-size: 0.9rem;"},{label:"Дата заказа",name:"order_date",field:l=>l.reserve.marketplace,sortable:!1,align:"left",headerStyle:"width: 20%;font-size: 0.9rem;"}];return(l,s)=>{var n,b,P,B,N,T,D,F,L,R,E;return o(),c(_,null,[e("div",pe,[C.value?(o(),c("div",_e,[e("h5",null,p(C.value),1)])):i("",!0)]),a.value?(o(),c("div",ve,[e("div",me,[e("div",he,[e("div",null,[e("div",ge,[e("div",fe,[e("div",ye,[ke,d(p(a.value.order_id),1)]),e("div",we,[be,d(p(a.value.id),1)])]),e("div",xe,[e("div",qe,[d(" Общая информация "),u(x,{onClick:s[0]||(s[0]=t=>w.value=!w.value)},{default:v(()=>[u(q,{name:w.value?"arrow_drop_up":"arrow_drop_down"},null,8,["name"])]),_:1})])]),u(ne,null,{default:v(()=>[w.value?(o(),c("div",ze,[u(ie,{class:"q-mt-lg"}),a.value?(o(),I(A,{key:0,columns:Z,rows:[a.value],dense:"","hide-bottom":"","row-key":"id","virtual-scroll":"","wrap-cells":""},{"body-cell":v(t=>[u(W,null,{default:v(()=>[t.col.name=="name"?(o(),c(_,{key:0},[d(p(t.row.product.name),1)],64)):i("",!0),t.col.name=="shop"?(o(),c(_,{key:1},[d(p(t.row.reserve.shop),1)],64)):i("",!0),t.col.name=="marketplace"?(o(),c(_,{key:2},[t.row.reserve.marketplace==="wb"?(o(),c(_,{key:0},[d(" Wildberries ")],64)):i("",!0),t.row.reserve.marketplace==="ozon"?(o(),c(_,{key:1},[d(" Ozon ")],64)):i("",!0)],64)):i("",!0),t.col.name=="price"?(o(),c(_,{key:3},[d(p(t.row.price),1)],64)):i("",!0)]),_:2},1024)]),_:1},8,["rows"])):i("",!0),a.value?(o(),I(A,{key:1,columns:ee,rows:[a.value],dense:"","hide-bottom":"","row-key":"id","virtual-scroll":"","wrap-cells":""},{"body-cell":v(t=>[u(W,null,{default:v(()=>[t.col.name=="color"?(o(),c(_,{key:0},[d(p(t.row.prop.color),1)],64)):i("",!0),t.col.name=="size"?(o(),c(_,{key:1},[d(p(t.row.prop.size),1)],64)):i("",!0),t.col.name=="order_date"?(o(),c(_,{key:2},[d(p(t.row.order_date),1)],64)):i("",!0),t.col.name=="reserve_id"?(o(),c(_,{key:3},[d(p(t.row.shipping_date),1)],64)):i("",!0)]),_:2},1024)]),_:1},8,["rows"])):i("",!0),e("div",je,[e("div",Ce,[$e,e("div",Ve,[(o(!0),c(_,null,G(a.value.reserve.orders,t=>(o(),c("div",null," №: "+p(t.order_id),1))),256))])])])])):i("",!0)]),_:1})])]),Ie,e("div",Se,[e("div",Qe,[(o(!0),c(_,null,G($.value,t=>(o(),c("div",{class:"col-xs-3 col-md-3 cursor-pointer col-lg-3",onClick:h=>Y(t)},[e("img",{src:t,alt:"ss",height:"auto",style:{"border-radius":"10px"},width:"100"},null,8,Ue)],8,Oe))),256))])]),e("div",Pe,[e("div",Be,[e("div",Ne,[a.value.is_found?i("",!0):(o(),I(x,{key:0,color:"green",outlined:"",onClick:M},{default:v(()=>[d("Товар найден")]),_:1}))])]),a.value.is_found?(o(),c("div",Te,[De,e("div",Fe,[u(S,{modelValue:r.value.product_pic,"onUpdate:modelValue":s[1]||(s[1]=t=>r.value.product_pic=t),accept:"image/*,.pdf",clearable:"",dense:"",label:"Фото",outlined:"",onInput:s[2]||(s[2]=t=>V("product_pic"))},{default:v(()=>[u(q,{class:"cursor-pointer",color:"grey",name:"attach_file",size:"1.2rem"})]),_:1},8,["modelValue"])]),e("div",Le,[r.value.product_pic?(o(),c("div",Re,[e("div",{class:"cursor-pointer",onClick:s[3]||(s[3]=t=>y(m(r.value.product_pic)))},[e("img",{src:m(r.value.product_pic),alt:"ss",height:"auto",style:{"border-radius":"10px"},width:"100"},null,8,Ee)])])):i("",!0),(n=a.value.images)!=null&&n.product_pic?(o(),c("div",Ge,[e("div",{class:"cursor-pointer",onClick:s[4]||(s[4]=t=>{var h;return y(m((h=a.value.images)==null?void 0:h.product_pic))})},[e("img",{src:(b=a.value.images)==null?void 0:b.product_pic,alt:"ss",height:"auto",style:{"border-radius":"10px"},width:"100"},null,8,Je)])])):i("",!0)])])):i("",!0),r.value.product_pic||(P=a.value.images)!=null&&P.product_pic?(o(),c("div",We,[Ae,e("div",He,[u(S,{modelValue:r.value.product_label,"onUpdate:modelValue":s[5]||(s[5]=t=>r.value.product_label=t),accept:"image/*,.pdf",clearable:"",dense:"",label:"Фото бирки",outlined:"",onInput:s[6]||(s[6]=t=>V("product_label"))},{default:v(()=>[u(q,{class:"cursor-pointer",color:"grey",name:"attach_file",size:"1.2rem"})]),_:1},8,["modelValue"])]),e("div",Ke,[r.value.product_label?(o(),c("div",Me,[e("div",{class:"cursor-pointer",onClick:s[7]||(s[7]=t=>y(m(r.value.product_label)))},[e("img",{src:m(r.value.product_label),alt:"ss",height:"auto",style:{"border-radius":"10px"},width:"100"},null,8,Xe)])])):i("",!0),(B=a.value.images)!=null&&B.product_label?(o(),c("div",Ye,[e("div",{class:"cursor-pointer",onClick:s[8]||(s[8]=t=>{var h;return y(m((h=a.value.images)==null?void 0:h.product_label))})},[e("img",{src:(N=a.value.images)==null?void 0:N.product_label,alt:"ss",height:"auto",style:{"border-radius":"10px"},width:"100"},null,8,Ze)])])):i("",!0)])])):i("",!0),e("div",null,[r.value.product_label||(T=a.value.images)!=null&&T.product_label?(o(),c("div",es,[e("div",null,[e("p",ss,"ID: заказа для печати штрихкода: "+p(a.value.id),1)]),e("div",ls,[u(x,{color:"green",onClick:X},{default:v(()=>[d("Штрихкод распечатан")]),_:1})])])):i("",!0)]),(r.value.product_label||(D=a.value.images)!=null&&D.product_label)&&r.value.is_sticker_printed?(o(),c("div",ts,[os,e("div",as,[u(S,{modelValue:r.value.product_package,"onUpdate:modelValue":s[9]||(s[9]=t=>r.value.product_package=t),accept:"image/*,.pdf",clearable:"",dense:"",label:"Фото собранного товара",outlined:"",onInput:s[10]||(s[10]=t=>V("product_package"))},{default:v(()=>[u(q,{class:"cursor-pointer",color:"grey",name:"attach_file",size:"1.2rem"})]),_:1},8,["modelValue"])]),e("div",rs,[r.value.product_package?(o(),c("div",cs,[e("div",{class:"cursor-pointer",onClick:s[11]||(s[11]=t=>y(m(r.value.product_package)))},[e("img",{src:m(r.value.product_package),alt:"ss",height:"auto",style:{"border-radius":"10px"},width:"100"},null,8,is)])])):i("",!0),(F=a.value.images)!=null&&F.product_package?(o(),c("div",ns,[e("div",{class:"cursor-pointer",onClick:s[12]||(s[12]=t=>{var h;return y(m((h=a.value.images)==null?void 0:h.product_package))})},[e("img",{src:(L=a.value.images)==null?void 0:L.product_package,alt:"ss",height:"auto",style:{"border-radius":"10px"},width:"100"},null,8,ds)])])):i("",!0)])])):i("",!0),r.value.product_package||(R=a.value.images)!=null&&R.product_package?(o(),c("div",us,[ps,e("div",_s,[u(re,{modelValue:r.value.components,"onUpdate:modelValue":s[13]||(s[13]=t=>r.value.components=t),options:O.value,type:"checkbox"},null,8,["modelValue","options"])])])):i("",!0),r.value.product_package||(E=a.value.images)!=null&&E.product_package?(o(),c("div",vs,[u(x,{color:"green",onClick:U},{default:v(()=>[d("Завершить")]),_:1})])):i("",!0)])])])])):i("",!0),z.value?(o(),c("div",ms,[e("div",hs,[gs,e("h3",null,"ID заказа: "+p(z.value),1)])])):i("",!0)],64)}}};export{Os as default};
