import{r as u,k as h,o as C,c as B,w as I,m as x,N as Q,b as i,a as t,e as N,n as P,f as y}from"./app-bb05d17f.js";import{Q as w}from"./QSelect-b751e38e.js";import{Q as k}from"./QPage-6a0c327f.js";import{_ as R}from"./RulesTable-7d9e9ac4.js";import"./QTable-7360ed10.js";import"./QPagination-06fc6825.js";const U={class:"bg-white q-ma-sm q-pa-sm"},D={class:"bg-white shadow-3 q-px-sm rounded-borders q-pb-md"},E={class:"row"},T={class:"col-5 row bg-grey-3 rounded-borders"},z={class:"row q-mt-sm q-ml-sm"},G={__name:"Index",setup(F){const v=u([]),p=u([]),d=u([]),c=u(!1),s=u({page:1,rowsPerPage:20,rowsNumber:0}),o=u({purpose_expression:"",operation_type:null,include_commons:!1}),m=async()=>{var n,e,a,r,g,_,b,f;try{const l=await x.get("/api/rules",{params:{load:["category,contractor"],paginate:s.value.rowsPerPage,page:s.value.page,purpose_expression:o.value.purpose_expression,operation_type:(n=o.value.operation_type)==null?void 0:n.value,include_commons:!!o.value.include_commons,contractor_ids:d.value?d.value.map(q=>q.id):null}});s.value.rowsNumber=(a=(e=l.data)==null?void 0:e.meta)==null?void 0:a.total,s.value.page=(g=(r=l.data)==null?void 0:r.meta)==null?void 0:g.current_page,s.value.totalPages=(b=(_=l.data)==null?void 0:_.meta)==null?void 0:b.last_page,v.value=(f=l==null?void 0:l.data)==null?void 0:f.data,console.log(l.data.data)}catch(l){console.log(l),Q.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}},V=async(n,e,a)=>{if(n.length>3){c.value=!0;try{const r=await x.get("/api/contractors",{params:{q:n}});p.value=r.data.data,e(()=>p.value)}catch(r){console.log(r),a()}finally{c.value=!1}}else p.value=[],e(()=>p.value)};return h(()=>{m()}),(n,e)=>(C(),B(k,{class:"bg-grey-2"},{default:I(()=>[i("div",U,[i("div",D,[e[5]||(e[5]=i("p",{class:"text-h6 text-center"}," Правила операций ",-1)),i("div",E,[t(N,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:o.value.purpose_expression,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.purpose_expression=a),label:"Регулярное выражение"},null,8,["modelValue"]),t(w,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:o.value.operation_type,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.operation_type=a),label:"Тип операции",options:[{label:"DEBIT",value:"DEBIT"},{label:"CREDIT",value:"CREDIT"}]},null,8,["modelValue"]),i("div",T,[t(w,{class:"q-px-sm col-8",dense:"",borderless:"",label:"Контрагенты (получатели)",modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=a=>d.value=a),options:p.value,"use-input":"",multiple:"",clearable:"","option-label":"name",onFilter:V,loading:c.value,"use-chips":""},null,8,["modelValue","options","loading"]),t(P,{class:"col-4",modelValue:o.value.include_commons,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.include_commons=a),label:"включая общие"},null,8,["modelValue"])])]),i("div",z,[t(y,{class:"text-right",dense:"",size:"sm",onClick:m,label:"Применить фильтры",color:"primary"}),t(y,{class:"text-right q-ml-sm",dense:"",size:"sm",to:{name:"CreateRule"},label:"Создать правило",color:"primary"})])]),t(R,{rules:v.value,pagination:s.value,"onUpdate:pagination":e[4]||(e[4]=a=>{s.value=a,m()}),onRefresh:m},null,8,["rules","pagination"])])]),_:1}))}};export{G as default};
