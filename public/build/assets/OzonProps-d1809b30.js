import{Q as j}from"./QTooltip-3ff6951b.js";import{r as i,o as u,c as h,w as a,u as H,Q as ye,a as e,b as F,d as n,f as V,e as P,g as Ve,i as b,s as Be,h as we,j as E,k as G,p as ze,l as xe,t as q,n as y,q as I,x as Ke,y as Ne,z as Re,L as He,B as je,F as C,D,v as z,H as _e,m as Fe,E as fe,G as ve,P as _,J as Z,N as ge}from"./app-64dafc3a.js";import{Q as J}from"./QSpace-767f85f1.js";import{Q as Ee}from"./QImg-4607bda3.js";import{a as be}from"./QSelect-fcdeceb1.js";import{Q as Te}from"./QBtnDropdown-c8281bd3.js";import{Q as Ae,a as Le}from"./QTable-9f10ca35.js";import{Q as ke}from"./QPagination-9c29fd07.js";import{C as T}from"./ClosePopup-9fac0edc.js";import{_ as Ze}from"./ImageDialog-5fc91dda.js";import{Q as he}from"./QForm-db958e76.js";import{u as A}from"./use-dialog-plugin-component-00e1baf8.js";import{_ as Ce}from"./_plugin-vue_export-helper-c27b6911.js";import"./position-engine-f936ecea.js";import"./QChip-18101fab.js";const $e=k=>(ze("data-v-90a039f9"),k=k(),xe(),k),Ge=$e(()=>n("h5",{class:"text-center"},"Изменение цены для ОЗОН",-1)),Je={class:"row"},Me={class:"col"},We={class:""},Xe={class:"q-mt-md q-card--bordered"},Ye=$e(()=>n("span",{class:"text-body2"}," Изменение прайса на указанное количество процентов/суммы ",-1)),el={class:"q-mt-md q-card--bordered"},ll={class:"q-mt-md q-card--bordered"},ol={class:"q-mt-md"},al={__name:"PriceDialog",emits:[...A.emits],setup(k){const w=i(0),v=i("increase"),g=i("percentage"),f=i("price_retail"),{dialogRef:r,onDialogHide:O,onDialogOK:U,onDialogCancel:N}=A(),S=(p,s)=>{U({default:{marketplace:p,price:s}})};function m(){U({ozon:{new_price:w.value,value:g.value,price_from:f.value,action:v.value}})}const x=(p,s)=>(p=p==="increase"?"":"-",s=s==="percentage"?"%":"₽",`${p}${s}`);return(p,s)=>(u(),h(ye,{ref_key:"dialogRef",ref:r,onHide:H(O)},{default:a(()=>[e(G,{class:"dialog q-pa-lg"},{default:a(()=>[Ge,e(he,{onSubmit:m},{default:a(()=>[e(F,{class:"q-gutter-md"},{default:a(()=>[n("div",Je,[n("div",Me,[n("div",We,[e(V,{mask:"#","fill-mask":"0","reverse-fill-mask":"",prefix:x(v.value,g.value),modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=d=>w.value=d)},null,8,["prefix","modelValue"])]),n("div",null,[n("div",Xe,[e(P,{modelValue:g.value,"onUpdate:modelValue":s[1]||(s[1]=d=>g.value=d),val:"percentage",label:"Проценты"},null,8,["modelValue"]),e(P,{modelValue:g.value,"onUpdate:modelValue":s[2]||(s[2]=d=>g.value=d),val:"value",label:"Сумма"},null,8,["modelValue"]),e(Ve,{class:"q-ml-lg text-h6",color:"grey",name:"help_outline"},{default:a(()=>[e(j,{anchor:"top end",self:"bottom middle"},{default:a(()=>[Ye]),_:1})]),_:1})]),n("div",el,[e(P,{modelValue:v.value,"onUpdate:modelValue":s[3]||(s[3]=d=>v.value=d),val:"increase",label:"Увеличение прайса"},null,8,["modelValue"]),e(P,{modelValue:v.value,"onUpdate:modelValue":s[4]||(s[4]=d=>v.value=d),val:"decrease",label:"Уменьшение прайса"},null,8,["modelValue"])])]),n("div",ll,[e(P,{modelValue:f.value,"onUpdate:modelValue":s[5]||(s[5]=d=>f.value=d),val:"price_retail",label:"Изменения от розничной"},null,8,["modelValue"]),e(P,{modelValue:f.value,"onUpdate:modelValue":s[6]||(s[6]=d=>f.value=d),val:"price_marketplace",label:"Изменения от мп"},null,8,["modelValue"]),e(P,{modelValue:f.value,"onUpdate:modelValue":s[7]||(s[7]=d=>f.value=d),val:"price_ozon",label:"Изменения от действительной"},null,8,["modelValue"])]),n("div",ol,[e(b,{color:"orange",size:"sm",onClick:s[8]||(s[8]=d=>S("price_ozon","price_retail")),label:"Сбросить до розничной",unelevated:""}),e(b,{color:"orange",size:"sm",class:"q-ml-md",onClick:s[9]||(s[9]=d=>S("price_ozon","price_marketplace")),label:"Сбросить до цены мп",unelevated:""})])])])]),_:1}),e(Be,{inset:""}),e(F),e(we,{align:"right"},{default:a(()=>[e(J),e(b,{color:"green",label:"OK",type:"submit",unelevated:""}),E(e(b,{color:"red",label:"Отмена",unelevated:""},null,512),[[T]])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}},tl=Ce(al,[["__scopeId","data-v-90a039f9"]]);const M=k=>(ze("data-v-5799312f"),k=k(),xe(),k),sl={class:"text-center"},nl={class:"row col-12 justify-center"},rl={class:"col-10"},dl={class:"col-10 q-mt-md"},il=M(()=>n("div",{class:"q-gutter-xs"},[n("span",null,"Цена до скидки")],-1)),cl=M(()=>n("span",{class:"text-body2"},"Цена может принимать значение 0 или значение выше базовой цены",-1)),ul={class:"col-10 q-mt-md"},pl=M(()=>n("div",{class:"q-gutter-xs"},[n("span",null,"Минимальная цена")],-1)),ml={class:"row col-9"},_l={key:0,class:"text-red"},fl={__name:"PriceBeforeSaleDialog",props:["product","old_price","min_price"],emits:[...A.emits],setup(k){const w=k,v=w.product,g=i(w.old_price),f=i(w.min_price),r=i(""),{dialogRef:O,onDialogHide:U,onDialogOK:N,onDialogCancel:S}=A();function m(){var x;g.value>((x=v==null?void 0:v.price)==null?void 0:x.price_ozon)||g.value===0?N({old_price:g.value,min_price:f.value}):r.value="*Цена может принимать значение 0 или значение выше базовой цены"}return(x,p)=>(u(),h(ye,{ref_key:"dialogRef",ref:O,onHide:H(U)},{default:a(()=>[e(G,{class:"dialog q-pa-lg"},{default:a(()=>{var s;return[n("h5",sl,"Изменение цен Озон для артикула "+q((s=H(v))==null?void 0:s.code),1),e(he,{onSubmit:m},{default:a(()=>[e(F,{class:"q-gutter-md"},{default:a(()=>{var d,R;return[n("div",nl,[n("div",rl,[e(V,{dense:"",label:"Цена","model-value":(R=(d=H(v))==null?void 0:d.price)==null?void 0:R.price_ozon,disable:"",outlined:""},null,8,["model-value"])]),n("div",dl,[e(V,{outlined:"",dense:"","reverse-fill-mask":"",type:"number",label:"Цена до скидки",modelValue:g.value,"onUpdate:modelValue":p[0]||(p[0]=B=>g.value=B)},{label:a(()=>[il]),append:a(()=>[e(Ve,{class:"text-grey",name:"help_outline"},{default:a(()=>[e(j,{"max-width":"250px",anchor:"top end",self:"bottom middle"},{default:a(()=>[cl]),_:1})]),_:1})]),_:1},8,["modelValue"])]),n("div",ul,[e(V,{outlined:"",dense:"","reverse-fill-mask":"",type:"number",label:"Цена до скидки",modelValue:f.value,"onUpdate:modelValue":p[1]||(p[1]=B=>f.value=B)},{label:a(()=>[pl]),_:1},8,["modelValue"])])]),n("div",ml,[r.value?(u(),y("div",_l,q(r.value),1)):I("",!0)])]}),_:1}),e(we,{align:"right"},{default:a(()=>[e(J),e(b,{color:"green",label:"OK",type:"submit",unelevated:""}),E(e(b,{color:"red",label:"Отмена",unelevated:""},null,512),[[T]])]),_:1})]),_:1})]}),_:1})]),_:1},8,["onHide"]))}},vl=Ce(fl,[["__scopeId","data-v-5799312f"]]),gl=n("p",{class:"text-caption"},"Через запятую без пробелов введите артикулы",-1),bl=n("p",{class:"text-caption"},"Через запятую без пробелов введите штрихкоды",-1),kl=["href"],yl={class:"flex flex-center"},Vl={class:"flex flex-center"},Kl={__name:"OzonProps",setup(k){const w=Ke(),v=Ne(),g=Re("auth"),f=i(),r=i({}),O=i(),U=i();i(),i(),i();const N=i();i();const S=i(),m=async t=>{_.show();try{const o=await axios.get("/api/ozon",{params:{...r.value,page:t,orderBy:O.value,orderDirection:U.value}}),{data:c,meta:l}=o.data;f.value=c,x.value=l.last_page,p.value=l.current_page,d.value=l.total,Ie()}catch(o){console.error(o)}_.hide()};He(()=>{v.name==="OzonProps"&&m()});const x=i(0),p=i(0),s=i({}),d=i(0),R=t=>`https://milavitsa.store${t}`;je(p,t=>{m(t)});const B={rowsNumber:50},Qe=()=>{r.value={...s.value},p.value=1,m()},Pe=t=>{Z.create({component:tl,componentProps:{product:t}}).onOk(async o=>{_.show();try{console.log(o),await axios.put(`/api/prices/${t}`,o),m()}catch(c){console.error(c),_.hide()}_.hide()})},De=async t=>{try{_.show();const o=await axios.get(`/api/ozon/prices/${t.code}`);_.hide(),o.data?Z.create({component:vl,componentProps:{product:t,old_price:o.data.old_price,min_price:o.data.min_price}}).onOk(async c=>{console.log(t.id,c),_.show();try{const l=await axios.put(`/api/ozon/prices/${t.code}`,c);m();const $=l.data;ge.create({color:$.error?"red":"green",message:$.error?$.error:$.success})}catch{console.error(error),_.hide()}_.hide()}):ge.create({color:"red",message:o.data.error})}catch(o){console.log(o)}},Ue=async(t,o)=>{_.show(),await axios.post("api/props/toggle-disabled",{barcodes:[t.barcode],field:[o]}).then(c=>{t.disabled=!t.disabled,_.hide()}).catch(function(c){console.log(c),_.hide()}),_.hide()},Ie=async()=>{_.show();const{data:t}=await axios.get("/api/product_categories");N.value=t.data,_.hide()},L=[{label:"Фото",name:"image",field:"image",sortable:!1,align:"left"},{label:"Артикул Озон",name:"ozon.name",field:t=>{var o;return(o=t.ozon_prop)==null?void 0:o.offer_id},sortable:!1,align:"left"},{label:"Название Милавица",name:"name",field:t=>{var o;return(o=t.product)==null?void 0:o.name},sortable:!1,align:"left"},{label:"Артикул",name:"product.code",field:t=>{var o;return(o=t.product)==null?void 0:o.code},sortable:!1,align:"left"},{label:"Штрихкод",name:"barcode",field:"barcode",sortable:!1,align:"left"},{label:"Размер",name:"size",field:"size",sortable:!1,align:"left"},{label:"Цвет",name:"color",field:"color",sortable:!1,align:"left"},{label:"Карточка ОЗОН",name:"ozon_code",field:"ozon_code",sortable:!1,align:"left"},{label:"Редактировать",name:"ozon_edit",sortable:!1,align:"left"},{label:"Цена OZON",name:"product.price.price_ozon",field:t=>{var o,c;return(c=(o=t.product)==null?void 0:o.price)==null?void 0:c.price_ozon},sortable:!1,align:"left"},{label:"Действия",name:"actions",sortable:!1,align:"left"}];if(g){const t=L.findIndex(o=>o.name==="ozon_code");L.splice(t+1,0,{label:"Статус",name:"ozon_disabled",field:o=>{var c;return(c=o.ozon_prop)==null?void 0:c.disabled},sortable:!1,align:"left"})}const qe=t=>{w.push(`/products/${t}`)},Oe=t=>{Z.create({component:Ze,componentProps:{image:t}})},Se=()=>{const t=Object.entries(r.value).map(([o,c])=>`${encodeURIComponent(o)}=${encodeURIComponent(c)}`).join("&");w.push({name:"GroupOzonProductUpdate",params:{filterParams:t}})};return(t,o)=>{var c;return u(),y(C,null,[e(G,null,{default:a(()=>[e(F,{class:"row q-gutter-sm justify-between items-start"},{default:a(()=>[e(V,{class:"col-1",modelValue:r.value.code,"onUpdate:modelValue":o[0]||(o[0]=l=>r.value.code=l),clearable:"",dense:"","hide-details":"",label:"Артикул",outlined:"",onKeypress:D(m,["enter"])},{default:a(()=>[e(j,{"max-width":"160px"},{default:a(()=>[gl]),_:1})]),_:1},8,["modelValue"]),e(V,{class:"col-1",modelValue:r.value.size,"onUpdate:modelValue":o[1]||(o[1]=l=>r.value.size=l),clearable:"",dense:"","hide-details":"",label:"Размер",outlined:"",onKeypress:D(m,["enter"])},null,8,["modelValue"]),e(V,{class:"col-1",modelValue:r.value.barcode,"onUpdate:modelValue":o[2]||(o[2]=l=>r.value.barcode=l),clearable:"",dense:"","hide-details":"",label:"Штрихкод",outlined:"",onKeypress:D(m,["enter"])},{default:a(()=>[e(j,{"max-width":"160px"},{default:a(()=>[bl]),_:1})]),_:1},8,["modelValue"]),e(V,{class:"col-1",modelValue:r.value.color,"onUpdate:modelValue":o[3]||(o[3]=l=>r.value.color=l),clearable:"",dense:"","hide-details":"",label:"Цвет",outlined:"",onKeypress:D(m,["enter"])},null,8,["modelValue"]),e(V,{class:"col-1",modelValue:r.value.name,"onUpdate:modelValue":o[4]||(o[4]=l=>r.value.name=l),clearable:"",dense:"","hide-details":"",label:"Название",outlined:"",onKeypress:D(m,["enter"])},null,8,["modelValue"]),e(V,{class:"col-1",modelValue:r.value.ozon_code,"onUpdate:modelValue":o[5]||(o[5]=l=>r.value.ozon_code=l),clearable:"",dense:"","hide-details":"",label:"Артикул OZON",outlined:"",onKeypress:D(m,["enter"])},null,8,["modelValue"]),e(V,{class:"col-1",modelValue:r.value.ozon_id,"onUpdate:modelValue":o[6]||(o[6]=l=>r.value.ozon_id=l),clearable:"",dense:"","hide-details":"",label:"OZON ID",outlined:"",onKeypress:D(m,["enter"])},null,8,["modelValue"]),e(J),e(b,{color:"green",outlined:"",onClick:m},{default:a(()=>[z("Искать")]),_:1}),e(b,{color:"red",outlined:"",onClick:Qe},{default:a(()=>[z("Сбросить")]),_:1}),e(b,{color:"white",class:"text-black",outline:"",onClick:Se},{default:a(()=>[z("Редактировать характеристики")]),_:1})]),_:1})]),_:1}),(c=f.value)!=null&&c.length?(u(),y(C,{key:0},[e(Ae,{columns:L,pagination:B,rows:f.value,dense:"","hide-bottom":"","row-key":"id",title:"Характеристики","virtual-scroll":"","wrap-cells":""},{"body-cell":a(l=>[e(Le,{class:_e(l.row.is_wrong?"bg-red-2":l.row.is_validated?"bg-green-2":""),item:l},{default:a(()=>{var $,W,X,Y,ee,le,oe,ae,te,se,ne,re,de,ie,ce,ue,pe;return[l.col.name=="image"?(u(),y(C,{key:0},[((W=($=l.row)==null?void 0:$.image)==null?void 0:W.src)!=null?(u(),h(Ee,{key:0,class:"cursor-pointer",onClick:Q=>{var K,me;return Oe((me=(K=l.row)==null?void 0:K.image)==null?void 0:me.src)},src:R((Y=(X=l.row)==null?void 0:X.image)==null?void 0:Y.src)},null,8,["onClick","src"])):I("",!0)],64)):l.col.name=="ozon_edit"?(u(),h(b,{key:1,outline:"",to:{name:"OzonProduct",params:{productId:l.row.ozon_prop.ozon_id}}},{default:a(()=>[z(" Редактировать ")]),_:2},1032,["to"])):l.col.name=="ozon_disabled"?(u(),y(C,{key:2},[l.row.ozon_prop?(u(),h(b,{key:0,color:l.row.ozon_prop.disabled==1?"yellow-4 text-black":"blue-4",outlined:"",text:"",onClick:Q=>Ue(l.row.ozon_prop,"ozon")},{default:a(()=>[l.row.ozon_prop.disabled==1?(u(),y(C,{key:0},[z(" Приостановлен ")],64)):(u(),y(C,{key:1},[z(" Продается ")],64))]),_:2},1032,["color","onClick"])):I("",!0)],64)):l.col.name=="ozon_code"?(u(),y(C,{key:3},[(le=(ee=l.row)==null?void 0:ee.ozon_prop)!=null&&le.sku&&((ae=(oe=l.row)==null?void 0:oe.ozon_prop)!=null&&ae.ozon_id)?(u(),y("a",{key:0,href:"https://ozon.ru/context/detail/id/"+((se=(te=l.row)==null?void 0:te.ozon_prop)==null?void 0:se.sku)},q((re=(ne=l.row)==null?void 0:ne.ozon_prop)==null?void 0:re.ozon_id),9,kl)):I("",!0)],64)):l.col.name=="product.price.price_retail"?(u(),y("span",{key:4,class:_e((ce=S.value)!=null&&ce.includes((ie=(de=l.row.product)==null?void 0:de.price)==null?void 0:ie.id)?"text-red":"text-black")},q((pe=(ue=l.row.product)==null?void 0:ue.price)==null?void 0:pe.price_retail),3)):l.col.name=="product.code"?(u(),h(b,{key:5,onClick:Q=>qe(l.row.product.id)},{default:a(()=>{var Q;return[z(q((Q=l.row.product)==null?void 0:Q.code),1)]}),_:2},1032,["onClick"])):(u(),y(C,{key:6},[z(q(l.value),1)],64)),l.col.name=="actions"?(u(),h(Te,{key:7,color:"primary",label:""},{default:a(()=>[e(Fe,null,{default:a(()=>[E((u(),h(fe,{clickable:"",onClick:Q=>{var K;return Pe((K=l.row.product)==null?void 0:K.id)}},{default:a(()=>[e(ve,null,{default:a(()=>[e(be,null,{default:a(()=>[z("Изменить цены")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[T]]),E((u(),h(fe,{clickable:"",onClick:Q=>De(l.row.product)},{default:a(()=>[e(ve,null,{default:a(()=>[e(be,null,{default:a(()=>[z("Изменить цены Озон")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[T]])]),_:2},1024)]),_:2},1024)):I("",!0)]}),_:2},1032,["class","item"])]),_:1},8,["rows"]),n("div",yl,[e(ke,{modelValue:p.value,"onUpdate:modelValue":o[7]||(o[7]=l=>p.value=l),max:x.value,"max-pages":6,"boundary-links":"","boundary-numbers":"",class:"q-mt-md","direction-links":""},null,8,["modelValue","max"])]),n("div",Vl,[e(ke,{modelValue:p.value,"onUpdate:modelValue":o[8]||(o[8]=l=>p.value=l),"boundary-links":!1,"direction-links":!1,max:x.value,"max-pages":6,class:"q-mt-md",input:""},null,8,["modelValue","max"])])],64)):I("",!0)],64)}}};export{Kl as default};
