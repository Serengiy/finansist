import{Q as j}from"./QSelect-fcdeceb1.js";import{y as z,r as p,z as S,L as B,o as f,c as I,w as r,d as t,a as c,t as P,u as E,n as b,i as u,v as l,q as k,f as M,k as R,P as s,N as i}from"./app-64dafc3a.js";import{Q as U}from"./QPage-18703bb0.js";import"./QChip-18101fab.js";import"./position-engine-f936ecea.js";const D={class:"row q-mx-auto bg-white"},F={class:"q-mt-lg"},L={class:"text-h4 q-py-lg"},O=t("div",{class:"text-h5 q-py-lg"},"Доступные действия: ",-1),A={key:0},G=t("div",{class:"text-h6"}," Перемещение заказа в другой магазин (с уведомлением) ",-1),H={class:"row q-mt-md justify-between"},J={class:"col-8"},K={key:0,class:"text-right"},W={class:"row q-mt-lg justify-between"},X=t("div",{class:"text-h6 col-8"}," Отправить уведомление в магазин ",-1),Y={class:"text-right col-2"},Z={class:"flex q-mt-lg items-center justify-between"},ee=t("div",{class:"text-h6"}," Удалить из резерва ",-1),te={class:"flex items-center justify-between q-mt-lg"},se=t("div",{class:"text-h6"},[l(" Удалить уведомление из чата "),t("p",{class:"text-body2"},"(Для заказов не принятых к сборке)")],-1),oe={class:"flex items-center justify-between q-mt-lg"},ae={class:"text-h6"},ie={class:"col-6"},re=t("div",{class:"q-gutter-xs"},[t("span",null,"Баркод")],-1),ce={class:""},_e={__name:"Manage",setup(de){var g,w,x,y;const d=z().params.orderId,h=p([]),m=p(null),o=S("user"),q=(w=(g=o==null?void 0:o.value)==null?void 0:g.id)==null?void 0:w.toString(),v=p(""),n=`?responsibleId=${q}&f=${(x=o==null?void 0:o.value)==null?void 0:x.f}&i=${(y=o==null?void 0:o.value)==null?void 0:y.i}`,V=async()=>{s.show();try{const e=await axios.get("/api/orders/manage/"+d);h.value=e.data.storesToMove,s.hide()}catch{s.hide()}},C=async()=>{s.show();try{(await axios.post("/api/orders/remove-reserve/"+d+`${n}`)).data.success&&(i.create({message:"Заказ удален из резерва",color:"positive",timeout:4e3}),setTimeout(()=>{window.location.href="/orders"},3e3)),s.hide()}catch{s.hide()}},$=async()=>{s.show();try{const e=await axios.delete("/api/orders/remove-notification/"+d+`${n}`);e.data.success&&i.create({message:"Уведомление удалено успешно",color:"positive",timeout:4e3}),e.data.error&&i.create({message:e.data.error,color:"negative",timeout:4e3})}catch{console.log()}s.hide()},N=async()=>{s.show();try{const e=await axios.post("/api/orders/send-notification/"+d+`${n}`);e.data.success&&i.create({message:"Уведомление успешно отправлено",color:"positive",timeout:4e3}),e.data.error&&i.create({message:e.data.error,color:"negative",timeout:4e3}),s.hide()}catch{s.hide()}},Q=async()=>{var e;s.show();try{const a=await axios.post("/api/orders/move/"+d+`${n}`,{store_id:(e=m.value)==null?void 0:e.shop_id});a.data.success&&(i.create({message:"Заказ успешно перемещен",color:"positive",timeout:4e3}),setTimeout(()=>{window.location.href="/orders"},3e3)),a.data.error&&i.create({message:a.data.error,color:"negative",timeout:3e3}),s.hide()}catch{s.hide()}},T=async()=>{try{const e=await axios.post(`/api/orders/${d}/replace${n}`,{barcode:v.value});e.data.success&&(i.create({message:"Товар успешно заменен",color:"positive",timeout:3e3}),setTimeout(()=>{window.location.href="/orders"},3e3)),e.data.error&&i.create({message:e.data.error,color:"negative",timeout:4e3})}catch(e){console.error(e)}};return B(()=>{V()}),(e,a)=>(f(),I(U,{class:"row shadow-3 bg-grey-2"},{default:r(()=>[t("div",D,[c(R,{class:"bg-white q-px-xl blue"},{default:r(()=>[t("div",F,[t("div",L,"Заказ № "+P(E(d)),1),O]),h.value.length?(f(),b("div",A,[G,t("div",H,[t("div",J,[c(j,{outlined:"",dense:"",modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=_=>m.value=_),options:h.value,"emit-value":"",label:"Выберите магазин","map-options":"","option-label":"store_name","option-value":"store_id"},null,8,["modelValue","options"])]),m.value?(f(),b("div",K,[c(u,{color:"green",dense:"",size:"md",onClick:Q},{default:r(()=>[l("Переместить")]),_:1})])):k("",!0)])])):k("",!0),t("div",W,[X,t("div",Y,[c(u,{size:"md",color:"green",dense:"",onClick:N},{default:r(()=>[l("Отправить")]),_:1})])]),t("div",Z,[ee,t("div",null,[c(u,{size:"md",color:"red",dense:"",onClick:C},{default:r(()=>[l("Удалить")]),_:1})])]),t("div",te,[se,t("div",null,[c(u,{size:"md",color:"red",dense:"",onClick:$},{default:r(()=>[l("Удалить")]),_:1})])]),t("div",oe,[t("div",ae,[l(" Заменить заказ "),t("div",ie,[c(M,{outlined:"",dense:"","reverse-fill-mask":"",label:"Баркод",modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=_=>v.value=_)},{label:r(()=>[re]),_:1},8,["modelValue"])])]),t("div",ce,[c(u,{size:"md",color:"blue",dense:"",onClick:T},{default:r(()=>[l("Заменить")]),_:1})])])]),_:1})])]),_:1}))}};export{_e as default};
