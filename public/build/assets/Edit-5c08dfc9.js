import{Q as p}from"./QSelect-aeca41c2.js";import{u as x,r,k as w,o as V,c as _,w as c,N as s,b as g,a as l,d as h,e as q,f as Q,g as C}from"./app-7be9a94d.js";import{Q as B}from"./QForm-d1a62da8.js";import{Q as I}from"./QPage-b4a12ee2.js";const E={class:"row q-mx-auto bg-white col-10 col-sm-8"},R={__name:"Edit",setup(T){const d=x().params.id,u=r([]),n=r(!1),i=r(null),t=r({name:"",purpose_expression:""}),f=[{label:"DEBIT",value:"DEBIT"},{label:"CREDIT",value:"CREDIT"}],v=async()=>{try{const a=await axios.get(`/api/rules/${d}`,{params:{include:"category"}});t.value=a.data.data,i.value=t.value.category}catch{s.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}};w(async()=>{await v()});const y=async()=>{var a;try{const e=await axios.put(`/api/rules/${d}`,t.value);(a=e==null?void 0:e.data)!=null&&a.success?s.create({message:"Данные успешно сохранены",color:"green",timeout:2e3}):s.create({message:"Ошибка сохранения данных",color:"red",timeout:2e3})}catch{s.create({message:"Ошибка сохранения данных",color:"red",timeout:2e3})}},b=async(a,e,o)=>{if(a.length>4){n.value=!0;try{const m=await axios.get("/api/categories",{params:{q:a}});u.value=m.data.data,e(()=>u.value)}catch{s.create({message:"Fetching categories failed",color:"red"})}n.value=!1}};return(a,e)=>(V(),_(I,{class:"row shadow-3 bg-grey-2"},{default:c(()=>[g("div",E,[l(C,{class:"bg-white q-px-xl blue col-12"},{default:c(()=>[e[3]||(e[3]=g("div",{class:"text-h4 q-mt-md"}," Редактирование правила ",-1)),l(B,{class:"q-mt-xl",onSubmit:h(y,["prevent"])},{default:c(()=>[l(p,{class:"col-3 q-mt-md",dense:"",clearable:"",outlined:"",filled:"",modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value=o),options:u.value,label:"Выберите категорию","option-value":"id","option-label":"name","use-input":"","input-debounce":"300",hint:"Start typing to search",onFilter:b,loading:n.value},null,8,["modelValue","options","loading"]),l(p,{class:"col-3 q-mt-md",dense:"",clearable:"",outlined:"",filled:"",modelValue:t.value.operation_type,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.operation_type=o),options:f,label:"Тип операции"},null,8,["modelValue"]),l(q,{"model-value":"name",label:"Регулярное выражение назначения",class:"col-3 q-mt-md",outlined:"",dense:"",modelValue:t.value.purpose_expression,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.purpose_expression=o),filled:""},null,8,["modelValue"]),l(Q,{class:"q-mt-md",label:"Сохранить",type:"submit",color:"primary"})]),_:1})]),_:1})])]),_:1}))}};export{R as default};
