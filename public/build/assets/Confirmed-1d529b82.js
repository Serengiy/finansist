import{y as X,r as p,R as Y,L as ee,B as te,o as a,n as i,d as e,t as m,v as n,a as u,w as h,i as f,c as C,q as r,f as se,F as v,P as b,N as le,g as oe,s as ae}from"./app-64dafc3a.js";import{a as D,Q as N}from"./QTable-9f10ca35.js";import{Q as re}from"./QSlideTransition-5ec42607.js";import{Q as ie}from"./QSelect-fcdeceb1.js";import{h as k}from"./html2pdf-792bb947.js";import"./QChip-18101fab.js";import"./position-engine-f936ecea.js";const ne={ref:"document",class:"hidden"},de={id:"barcodeForPdf",style:{transform:"rotateZ(90deg)",width:"200px",height:"210px",display:"flex","flex-direction":"column","justify-content":"end","align-items":"center"}},ce={class:"",style:{"font-size":".6rem"}},ue=e("div",{class:"text-left"},"Поставщик: ИП Дятлова.А.А",-1),me={class:"text-left"},he=e("span",null,"Бренд: MilaVitsa ",-1),pe={class:"text-left"},ve=["src"],_e={class:"q-pl-sm q-mb-md",style:{"font-size":".6rem"}},fe={class:"hidden"},ge={id:"qrcodeForPdf"},ye=["src"],we={class:"hidden"},be={id:"ozonStickerImage"},ke=["src"],xe={class:"q-pa-lg full-height"},qe={class:"row justify-center"},ze={key:0,class:"col-sm-9"},Se={class:"order-details"},Qe={class:"row"},Ce={class:"col-12 text-h5"},je=e("b",null,"Номер заказа: ",-1),Fe={class:"row text-center q-mt-lg"},Ie={class:"col-12 text-h6"},Pe={key:0},Re={class:"row col-12 q-mt-lg justify-center"},Be={key:0,class:"row justify-center col-12 q-mt-lg"},Ee=e("div",{class:"col-xs-3 col-sm-3"},[e("p",null,[e("b",null,"Печать штрихкода:")])],-1),De={class:"col-xs-9 col-sm-9"},Ne={key:0,class:"flex justify-between text-center"},Ve={key:1,class:"row justify-center col-12 q-mt-lg"},$e=e("div",{class:"col-xs-3 col-sm-3"},[e("p",null,[e("b",null,"Печать qr-кода:")])],-1),Te={class:"col-xs-9 col-sm-9"},Ue={key:2,class:"row justify-center col-12 q-mt-lg"},Oe={class:"q-mt-lg"},Ze={key:1,class:"col-sm-9"},Le=e("div",{class:"text-center"},[e("h4",null,"Найти заказ")],-1),Ge={class:"row justify-center col-12 q-mt-lg"},Me={class:"row col-12 q-mt-lg"},We=e("div",{class:"col-xs-3 col-sm-2"},[e("p",null,[e("b",null,"ID заказа:")])],-1),Ae={class:"col-xs-9 col-sm-10"},He={class:"row"},Je={class:"row q-mt-lg"},Ke={key:0,class:"text-red text-center q-mt-sm"},Xe={class:"row justify-center"},Ye={class:"row col-12 justify-center"},et={class:"col-5 q-mt-lg"},tt={key:0,class:"row col-4 q-mt-lg justify-between"},ct={__name:"Confirmed",setup(st){const V=X(),c=p(),x=p(),S=p(),q=p(!1),g=p(),j=p(null),w=p(),_=p(null),z=p(),Q=p(null),$=[{id:2,value:"Краснодар"},{id:1,value:"Анапа"},{id:4,value:"Армавир"}],T=Y(()=>{const t=[];return _.value.some(s=>s.shop_id===1)||t.push(1),_.value.some(s=>s.shop_id===4)||t.push(4),_.value.some(s=>[2,3,5,6].includes(s.shop_id))||t.push(2,3,5,6),s=>t.includes(s.id)}),U=()=>{try{axios.get("/api/supplies/active-supplies").then(t=>{_.value=t.data.supplies})}catch(t){console.log(t)}},O=async()=>{var t,s;b.show();try{const l=await axios.get(`/api/orders/${x.value}/confirmed`);l.data.error?S.value=l.data.error:(c.value=await l.data.order,g.value=await l.data.barcode,z.value=await((t=l.data)==null?void 0:t.ozon_sticker),Q.value=await((s=l.data)==null?void 0:s.wb_qr)),M()}catch(l){console.error(l)}b.hide()};ee(()=>{V.name==="OrderConfirmed"&&U()}),p(0);const F={rowsNumber:50},Z=()=>{c.value=null,x.value=null,z.value=null};te(w,(t,s)=>{if(t!==null){if(t.id===1){const l=_.value.find(d=>d.shop_id===1);l&&(t.id=l.supply_id)}else if(t.id===4){const l=_.value.find(d=>d.shop_id===4);l&&(t.id=l.supply_id)}else if(t.id===2){const l=_.value.find(d=>[2,3,5,6].includes(d.shop_id));l&&(t.id=l.supply_id)}}});const L=()=>{var t,s;k(document.getElementById("barcodeForPdf"),{filename:(s=(t=c.value)==null?void 0:t.prop)==null?void 0:s.barcode,html2canvas:{letterRendering:!0,scale:4,backgroundColor:"#f0f0f0"},jsPDF:{unit:"mm",format:[57,29]}})},G=async()=>{j.value="data:image/png;base64,"+Q.value,k(document.getElementById("qrcodeForPdf"),{filename:"qr-code",html2canvas:{width:120,height:210,scale:4,letterRendering:!0,x:30,y:-60},jsPDF:{unit:"mm",format:[55,29]}})},M=()=>{const t=new Image;t.onload=()=>{const s=document.createElement("canvas"),l=s.getContext("2d");s.width=t.width,s.height=t.height,l.drawImage(t,0,0),g.value=s.toDataURL("image/png")},t.src="data:image/svg+xml;base64,"+btoa(g.value),g.value=t},W=async t=>{b.show();try{(await axios.get(`/api/supplies/box-qr/${t}`)).data.qrs.forEach(d=>{console.log(d);const y=document.createElement("img");y.src="data:image/png;base64,"+d,y.width=200,y.style.transform="rotate(90deg)",k(y,{filename:t,html2canvas:{width:150,height:240,scale:4,letterRendering:!0,x:21,y:-80},jsPDF:{unit:"mm",format:[55,29]}})})}catch(s){console.log(s)}b.hide()},A=async t=>{b.show();try{await axios.get(`/api/supplies/supply-qr/${t}`).then(s=>{if(s.data.error)le.create({message:s.data.error,color:"red"});else{let l="data:image/png;base64,"+s.data.supply,d=document.createElement("img");d.src=l,d.style.transform="rotate(90deg)",d.style.width="200px",k(d,{filename:"QR-поставки",html2canvas:{width:150,height:280,scale:4,letterRendering:!0,x:21,y:-80},jsPDF:{unit:"mm",format:[55,29]}})}})}catch(s){console.log(s)}b.hide()},H=async()=>{k(document.getElementById("ozonStickerImage"),{filename:"ozon-sticker",html2canvas:{width:115,height:210,scale:6,letterRendering:!0,x:40,y:-63},jsPDF:{unit:"mm",format:[55,29]}})},J=[{label:"Название",name:"name",field:t=>t.product.name,sortable:!1,align:"left",headerStyle:"width: 40%;font-size: 0.9rem;"},{label:"Магазин",name:"shop",field:t=>t.reserve.shop,sortable:!1,align:"left",headerStyle:"width: 20%;font-size: 0.9rem;"},{label:"Маркетплейс",name:"marketplace",field:t=>t.reserve.marketplace,sortable:!1,align:"left",headerStyle:"width: 20%;font-size: 0.9rem;"},{label:"Цена заказа",name:"price",field:"price",sortable:!1,align:"left",headerStyle:"width: 20%;font-size: 0.9rem;"}],K=[{label:"Дата отгрузки",name:"reserve_id",field:"price",sortable:!1,align:"left",headerStyle:"width: 40%;font-size: 0.9rem;"},{label:"Цвет",name:"color",field:t=>t.product.name,sortable:!1,align:"left",headerStyle:"width: 20%;font-size: 0.9rem;"},{label:"Размер",name:"size",field:t=>t.reserve.shop,sortable:!1,align:"left",headerStyle:"width: 20%;font-size: 0.9rem;"},{label:"Дата заказа",name:"order_date",field:t=>t.reserve.marketplace,sortable:!1,align:"left",headerStyle:"width: 20%;font-size: 0.9rem;"}];return(t,s)=>{var l,d,y,I,P,R,B,E;return a(),i(v,null,[e("div",ne,[e("div",de,[e("div",ce,[ue,e("div",me,[e("span",null,"Артикул: "+m((d=(l=c.value)==null?void 0:l.product)==null?void 0:d.code),1),n(),he]),e("div",pe,[e("span",null," Размер: "+m((I=(y=c.value)==null?void 0:y.prop)==null?void 0:I.size),1),e("span",null," Цвет: "+m((R=(P=c.value)==null?void 0:P.prop)==null?void 0:R.color),1)])]),e("div",null,[e("img",{src:g.value,alt:""},null,8,ve)]),e("div",_e," Баркод: "+m((B=c.value)==null?void 0:B.prop.barcode),1)])],512),e("div",fe,[e("div",ge,[e("img",{src:j.value,alt:"SVG File",height:"100",style:{transform:"rotateZ(90deg)"},width:"180"},null,8,ye)])]),e("div",we,[e("div",be,[e("img",{src:z.value,alt:"",height:"100px",style:{transform:"rotateZ(90deg)"},width:"200px"},null,8,ke)])]),e("div",xe,[e("div",qe,[c.value?(a(),i("div",ze,[e("div",null,[e("div",Se,[e("div",Qe,[e("div",Ce,[je,n(m(c.value.order_id),1)])]),e("div",Fe,[e("div",Ie,[n(" Общая информация "),u(f,{onClick:s[0]||(s[0]=o=>q.value=!q.value)},{default:h(()=>[u(oe,{name:q.value?"arrow_drop_up":"arrow_drop_down"},null,8,["name"])]),_:1})])]),u(re,null,{default:h(()=>[q.value?(a(),i("div",Pe,[u(ae,{class:"q-mt-lg"}),c.value?(a(),C(N,{key:0,columns:J,pagination:F,rows:[c.value],dense:"","hide-bottom":"","row-key":"id","virtual-scroll":"","wrap-cells":""},{"body-cell":h(o=>[u(D,null,{default:h(()=>[o.col.name=="name"?(a(),i(v,{key:0},[n(m(o.row.product.name),1)],64)):r("",!0),o.col.name=="shop"?(a(),i(v,{key:1},[n(m(o.row.reserve.shop),1)],64)):r("",!0),o.col.name=="marketplace"?(a(),i(v,{key:2},[o.row.reserve.marketplace==="wb"?(a(),i(v,{key:0},[n(" Wildberries ")],64)):r("",!0),o.row.reserve.marketplace==="ozon"?(a(),i(v,{key:1},[n(" Ozon ")],64)):r("",!0)],64)):r("",!0),o.col.name=="price"?(a(),i(v,{key:3},[n(m(o.row.price),1)],64)):r("",!0)]),_:2},1024)]),_:1},8,["rows"])):r("",!0),c.value?(a(),C(N,{key:1,columns:K,pagination:F,rows:[c.value],dense:"","hide-bottom":"","row-key":"id","virtual-scroll":"","wrap-cells":""},{"body-cell":h(o=>[u(D,null,{default:h(()=>[o.col.name=="color"?(a(),i(v,{key:0},[n(m(o.row.prop.color),1)],64)):r("",!0),o.col.name=="size"?(a(),i(v,{key:1},[n(m(o.row.prop.size),1)],64)):r("",!0),o.col.name=="order_date"?(a(),i(v,{key:2},[n(m(o.row.order_date),1)],64)):r("",!0),o.col.name=="reserve_id"?(a(),i(v,{key:3},[n(m(o.row.shipping_date),1)],64)):r("",!0)]),_:2},1024)]),_:1},8,["rows"])):r("",!0)])):r("",!0)]),_:1})])]),e("div",Re,[g.value?(a(),i("div",Be,[Ee,e("div",De,[((E=c.value)==null?void 0:E.reserve.marketplace)==="wb"?(a(),i("div",Ne,[e("div",null,[g.value?(a(),C(f,{key:0,color:"green",onClick:L},{default:h(()=>[n("Распечатать")]),_:1})):r("",!0)])])):r("",!0)])])):r("",!0),Q.value?(a(),i("div",Ve,[$e,e("div",Te,[e("div",null,[u(f,{onClick:G,color:"green"},{default:h(()=>[n("Распечатать")]),_:1})])])])):r("",!0),z.value?(a(),i("div",Ue,[u(f,{color:"green",onClick:H},{default:h(()=>[n("Скачать файлы")]),_:1})])):r("",!0),e("div",Oe,[u(f,{color:"green",onClick:Z},{default:h(()=>[n("Завершить")]),_:1})])])])):r("",!0),!c.value&&_.value?(a(),i("div",Ze,[Le,e("div",Ge,[e("div",Me,[We,e("div",Ae,[e("div",He,[u(se,{label:"№",modelValue:x.value,"onUpdate:modelValue":s[1]||(s[1]=o=>x.value=o),class:"full-width",outlined:"",dense:""},null,8,["modelValue"])])])]),e("div",Je,[u(f,{onClick:O,color:"green"},{default:h(()=>[n("Найти заказ")]),_:1})])]),S.value?(a(),i("div",Ke,[e("h6",null,m(S.value),1)])):r("",!0),e("div",Xe,[e("div",Ye,[e("div",et,[u(ie,{modelValue:w.value,"onUpdate:modelValue":s[2]||(s[2]=o=>w.value=o),outlined:"",dense:"",label:"QR-коды","option-label":"value",options:$,"option-disable":T.value},null,8,["modelValue","option-disable"])])]),w.value?(a(),i("div",tt,[u(f,{color:"blue",onClick:s[3]||(s[3]=o=>A(w.value.id)),size:"sm"},{default:h(()=>[n("QR-поставки")]),_:1}),u(f,{color:"blue",onClick:s[4]||(s[4]=o=>W(w.value.id)),size:"sm"},{default:h(()=>[n("QR-коробов")]),_:1})])):r("",!0)])])):r("",!0)])])],64)}}};export{ct as default};
