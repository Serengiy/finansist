import{u as _,r as u,k as w,o as V,c as q,w as n,N as l,b as m,a as t,f as g,q as Q,d as C,e as h,g as B}from"./app-50d861a6.js";import{Q as v}from"./QSelect-e2550d64.js";import{Q as I}from"./QForm-965a7f1e.js";import{Q as T}from"./QPage-0cffa8d3.js";const E={class:"row q-mx-auto bg-white col-10 col-sm-8"},U={__name:"Edit",setup(N){const c=_().params.id,i=u([]),d=u(!1),r=u(null),o=u({name:"",purpose_expression:""}),y=[{label:"DEBIT",value:"DEBIT"},{label:"CREDIT",value:"CREDIT"}],f=async()=>{try{const a=await axios.get(`/api/rules/${c}`,{params:{include:"category"}});o.value=a.data.data,r.value=o.value.category}catch{l.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}};w(async()=>{await f()});const b=async()=>{var a;try{const e=await axios.put(`/api/rules/${c}`,{category_id:r.value.id,operation_type:o.value.operation_type,purpose_expression:o.value.purpose_expression});(a=e==null?void 0:e.data)!=null&&a.success?l.create({message:"Данные успешно сохранены",color:"green",timeout:2e3}):l.create({message:"Ошибка сохранения данных",color:"red",timeout:2e3})}catch{l.create({message:"Ошибка сохранения данных",color:"red",timeout:2e3})}},x=async(a,e,s)=>{if(a.length>4){d.value=!0;try{const p=await axios.get("/api/categories",{params:{q:a}});i.value=p.data.data,e(()=>i.value)}catch{l.create({message:"Fetching categories failed",color:"red"})}d.value=!1}};return(a,e)=>(V(),q(T,{class:"row shadow-3 bg-grey-2"},{default:n(()=>[m("div",E,[t(B,{class:"bg-white q-px-xl blue col-12"},{default:n(()=>[t(g,{class:"q-my-md",icon:"arrow_back",to:"/operations/rules"},{default:n(()=>e[3]||(e[3]=[Q("Назад")])),_:1}),e[4]||(e[4]=m("div",{class:"text-h4"}," Редактирование правила ",-1)),t(I,{class:"q-mt-xl",onSubmit:C(b,["prevent"])},{default:n(()=>[t(v,{class:"col-3 q-mt-md",dense:"",clearable:"",outlined:"",filled:"",modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value=s),options:i.value,label:"Выберите категорию","option-value":"id","option-label":"name","use-input":"","input-debounce":"300",hint:"Start typing to search",onFilter:x,loading:d.value},null,8,["modelValue","options","loading"]),t(v,{class:"col-3 q-mt-md",dense:"",clearable:"",outlined:"",filled:"",modelValue:o.value.operation_type,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.operation_type=s),options:y,label:"Тип операции"},null,8,["modelValue"]),t(h,{"model-value":"name",label:"Регулярное выражение назначения",class:"col-3 q-mt-md",outlined:"",dense:"",modelValue:o.value.purpose_expression,"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.purpose_expression=s),filled:""},null,8,["modelValue"]),t(g,{class:"q-mt-md",label:"Сохранить",type:"submit",color:"primary"})]),_:1})]),_:1})])]),_:1}))}};export{U as default};
