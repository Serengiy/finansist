import{u as P,r as i,j as N,k as I,x as T,o as U,c as A,w as q,N as u,b as a,a as s,a1 as F,q as g,O as h,t as V,f as y,e as c,P as Q}from"./app-c4ae35b2.js";import{Q as j}from"./QPage-9bb265f7.js";import{_ as z}from"./OperationTable-4428e878.js";import"./QTable-32972736.js";import"./QSelect-01fc4ee7.js";import"./QPagination-2734e45b.js";const B={class:"row justify-center"},O={class:"row justify-center col-12 q-px-md q-pt-lg q-mb-sm"},R={class:"text-blue-5 row full-width"},S=["onClick"],$={class:"col-12 bg-white shadow-24 q-pa-sm rounded-borders q-mb-md"},D={class:"row"},M={class:"col-12 text-h6"},E={class:"col-12 text-h6"},G={class:"col-3 bg-accent bg-white shadow-24 q-pa-sm rounded-borders mb"},H={class:"row"},J={class:"text-body2 q-mt-md"},K={class:"text-body2 q-mt-md"},L={class:"col-9 bg-grey-3 q-px-sm"},W={class:"bg-white shadow-3 q-px-sm rounded-borders q-pb-md"},X={class:"row"},Y={class:"row q-mt-sm"},Z={class:"row q-mt-sm q-ml-sm"},de={__name:"Operations",setup(ee){const d=P().params.id,b=i([]),_=i(!1),v=i({}),r=i({page:1,rowsPerPage:20,rowsNumber:0}),t=i({purposeQuery:"",categoryQuery:"",dateAt:null,dateFrom:null,dateTo:null,payeeContractorIds:[]});N(t,()=>{r.value.page=1},{deep:!0});const m=async()=>{var l,e,p,o,f,w,x;try{const n=await axios.get("/api/operations",{params:{payeeContractorId:d,paginate:r.value.rowsPerPage,page:r.value.page,dateAt:t.value.dateAt,dateTo:t.value.dateTo,dateFrom:t.value.dateFrom,purposeQuery:t.value.purposeQuery,categoryQuery:t.value.categoryQuery}});b.value=(l=n==null?void 0:n.data)==null?void 0:l.data,r.value.rowsNumber=(p=(e=n.data)==null?void 0:e.meta)==null?void 0:p.total,r.value.page=(f=(o=n.data)==null?void 0:o.meta)==null?void 0:f.current_page,r.value.totalPages=(x=(w=n.data)==null?void 0:w.meta)==null?void 0:x.last_page}catch{u.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}},k=async()=>{try{const l=await axios.get("/api/contractors/"+d);v.value=l.data.data}catch{u.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}},C=async()=>{Q.show(),_.value=!0;try{const l=await axios.get(`/api/contractors/${d}/check`);l.data.success?u.create({message:l.data.message,color:"green",timeout:2e3}):u.create({message:"Ошибка проверки",color:"red",timeout:2e3})}catch{u.create({message:"Ошибка проверки",color:"red",timeout:2e3})}_.value=!1,Q.hide()};return I(()=>{k(),m()}),(l,e)=>{const p=T("router-link");return U(),A(j,{class:"bg-grey-3"},{default:q(()=>[a("div",B,[a("div",O,[a("p",R,[s(p,{to:{name:"ContractorShow",params:{id:h(d)}},custom:""},{default:q(({navigate:o})=>[a("div",{onClick:o,class:"cursor-pointer"},[s(F,{size:"sm",name:"keyboard_arrow_left"}),e[6]||(e[6]=g(" Назад "))],8,S)]),_:1},8,["to"])]),a("div",$,[e[7]||(e[7]=a("div",{class:"row justify-center"},[a("span",{class:"text-h6"}," Информация о контрагенте ")],-1)),a("div",D,[a("div",M," Имя контрагента: "+V(v.value.full_name),1),a("div",E," ИНН контрагента: "+V(v.value.inn_kpp),1)])]),a("div",G,[a("div",H,[e[10]||(e[10]=a("span",{class:"text-h6 text-center"}," Действия ",-1)),a("span",J,[e[8]||(e[8]=g(" Проверить все операции контрагента: ")),s(y,{class:"q-ml-sm",dense:"",size:"sm",onClick:C,label:"проверить",color:"primary"})]),a("span",K,[e[9]||(e[9]=g(" Создать новую операцию: ")),s(y,{class:"q-ml-sm",dense:"",size:"sm",to:{name:"OperationCreate",params:{contractorId:h(d)}},label:"создать",color:"primary"},null,8,["to"])])])]),a("div",L,[a("div",W,[e[11]||(e[11]=a("p",{class:"text-h6 text-center"}," Операции контрагента ",-1)),a("div",X,[s(c,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:t.value.dateAt,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.dateAt=o),label:"Дата",type:"date"},null,8,["modelValue"]),s(c,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:t.value.categoryQuery,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.categoryQuery=o),label:"Категории"},null,8,["modelValue"]),s(c,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:t.value.purposeQuery,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.purposeQuery=o),label:"Назначение"},null,8,["modelValue"])]),a("div",Y,[s(c,{class:"col-2 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:t.value.dateFrom,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.dateFrom=o),label:"Дата начала",type:"date"},null,8,["modelValue"]),s(c,{class:"col-2 q-px-sm",dense:"",clearable:"",outlined:"",filled:"",modelValue:t.value.dateTo,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.dateTo=o),label:"Дата окончания",type:"date"},null,8,["modelValue"])]),a("div",Z,[s(y,{class:"text-right",dense:"",size:"sm",onClick:m,label:"Применить фильтры",color:"primary"})])]),s(z,{operations:b.value,pagination:r.value,"onUpdate:pagination":e[5]||(e[5]=o=>{r.value=o,m()}),onRefresh:m},null,8,["operations","pagination"])])])])]),_:1})}}};export{de as default};
