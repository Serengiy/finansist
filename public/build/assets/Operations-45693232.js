import{C as ce,ae as me,af as A,ag as pe,ah as ve,G as fe,r as h,v as V,ai as ge,aj as he,ak as ye,al as be,am as we,j as H,an as F,ao as z,ap as L,aq as R,ar as _e,J as W,T as Te,K as xe,ac as qe,u as Pe,k as ke,U as Ce,o as Se,c as Ve,w as _,N as q,b as s,a as n,n as Oe,s as E,a5 as Qe,t as $,f as j,e as P,P as G}from"./app-4df6b152.js";import{u as Ae,v as J,b as Ee,c as je,d as He,r as K,s as Ne,p as X,e as Ue}from"./QSelect-995ec182.js";import{Q as Be}from"./QPage-b9f7ef16.js";import{_ as De}from"./OperationTable-ba754ae8.js";import"./QTable-2b5d2408.js";import"./QPagination-21b8a7aa.js";const Y=ce({name:"QTooltip",inheritAttrs:!1,props:{...Ae,...me,...A,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{...A.transitionShow,default:"jump-down"},transitionHide:{...A.transitionHide,default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:J},self:{type:String,default:"top middle",validator:J},offset:{type:Array,default:()=>[14,14],validator:Ee},scrollTarget:pe,delay:{type:Number,default:0},hideDelay:{type:Number,default:0},persistent:Boolean},emits:[...ve],setup(a,{slots:N,emit:v,attrs:y}){let p,c;const r=fe(),{proxy:{$q:t}}=r,u=h(null),b=h(!1),k=V(()=>X(a.anchor,t.lang.rtl)),i=V(()=>X(a.self,t.lang.rtl)),e=V(()=>a.persistent!==!0),{registerTick:w,removeTick:o}=ge(),{registerTimeout:f}=he(),{transitionProps:C,transitionStyle:S}=ye(a),{localScrollTarget:d,changeScrollEvent:Z,unconfigureScrollTarget:ee}=je(a,I),{anchorEl:m,canShow:te,anchorEvents:T}=He({showing:b,configureAnchorEl:ie}),{show:ae,hide:O}=be({showing:b,canShow:te,handleShow:se,handleHide:le,hideOnRouteChange:e,processOnMount:!0});Object.assign(T,{delayShow:ne,delayHide:re});const{showPortal:U,hidePortal:B,renderPortal:oe}=we(r,u,de,"tooltip");if(t.platform.is.mobile===!0){const l={anchorEl:m,innerRef:u,onClickOutside(g){return O(g),g.target.classList.contains("q-dialog__backdrop")&&qe(g),!0}},Q=V(()=>a.modelValue===null&&a.persistent!==!0&&b.value===!0);H(Q,g=>{(g===!0?Ue:K)(l)}),F(()=>{K(l)})}function se(l){U(),w(()=>{c=new MutationObserver(()=>x()),c.observe(u.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),x(),I()}),p===void 0&&(p=H(()=>t.screen.width+"|"+t.screen.height+"|"+a.self+"|"+a.anchor+"|"+t.lang.rtl,x)),f(()=>{U(!0),v("show",l)},a.transitionDuration)}function le(l){o(),B(),D(),f(()=>{B(!0),v("hide",l)},a.transitionDuration)}function D(){c!==void 0&&(c.disconnect(),c=void 0),p!==void 0&&(p(),p=void 0),ee(),z(T,"tooltipTemp")}function x(){Ne({targetEl:u.value,offset:a.offset,anchorEl:m.value,anchorOrigin:k.value,selfOrigin:i.value,maxHeight:a.maxHeight,maxWidth:a.maxWidth})}function ne(l){if(t.platform.is.mobile===!0){L(),document.body.classList.add("non-selectable");const Q=m.value,g=["touchmove","touchcancel","touchend","click"].map(M=>[Q,M,"delayHide","passiveCapture"]);R(T,"tooltipTemp",g)}f(()=>{ae(l)},a.delay)}function re(l){t.platform.is.mobile===!0&&(z(T,"tooltipTemp"),L(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),f(()=>{O(l)},a.hideDelay)}function ie(){if(a.noParentEvent===!0||m.value===null)return;const l=t.platform.is.mobile===!0?[[m.value,"touchstart","delayShow","passive"]]:[[m.value,"mouseenter","delayShow","passive"],[m.value,"mouseleave","delayHide","passive"]];R(T,"anchor",l)}function I(){if(m.value!==null||a.scrollTarget!==void 0){d.value=_e(m.value,a.scrollTarget);const l=a.noParentEvent===!0?x:O;Z(d.value,l)}}function ue(){return b.value===!0?W("div",{...y,ref:u,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",y.class],style:[y.style,S.value],role:"tooltip"},xe(N.default)):null}function de(){return W(Te,C.value,ue)}return F(D),Object.assign(r.proxy,{updatePosition:x}),oe}}),Ie={class:"row justify-center"},Me={class:"row justify-center col-12 q-px-md q-pt-lg q-mb-sm"},Fe={class:"text-blue-5 row full-width"},ze=["onClick"],Le={class:"col-12 bg-white shadow-24 q-pa-md rounded-borders q-mb-md"},Re={class:"row"},We={class:"col-12 text-h6"},$e={class:"col-12 text-h6"},Ge={class:"col-12 bg-grey-3 q-px-sm"},Je={class:"bg-white shadow-3 q-px-sm rounded-borders q-pb-md"},Ke={class:"row"},Xe={class:"row q-mt-sm"},Ye={class:"row q-mt-sm q-ml-sm"},lt={__name:"Operations",setup(a){const v=Pe().params.id,y=h([]),p=h(!1),c=h({}),r=h({page:1,rowsPerPage:20,rowsNumber:0}),t=h({purposeQuery:"",categoryQuery:"",dateAt:null,dateFrom:null,dateTo:null,payeeContractorIds:[]});H(t,()=>{r.value.page=1},{deep:!0});const u=async()=>{var i,e,w,o,f,C,S;try{const d=await axios.get("/api/operations",{params:{payeeContractorId:v,paginate:r.value.rowsPerPage,page:r.value.page,dateAt:t.value.dateAt,dateTo:t.value.dateTo,dateFrom:t.value.dateFrom,purposeQuery:t.value.purposeQuery,categoryQuery:t.value.categoryQuery}});y.value=(i=d==null?void 0:d.data)==null?void 0:i.data,r.value.rowsNumber=(w=(e=d.data)==null?void 0:e.meta)==null?void 0:w.total,r.value.page=(f=(o=d.data)==null?void 0:o.meta)==null?void 0:f.current_page,r.value.totalPages=(S=(C=d.data)==null?void 0:C.meta)==null?void 0:S.last_page}catch{q.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}},b=async()=>{try{const i=await axios.get("/api/contractors/"+v);c.value=i.data.data}catch{q.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}},k=async()=>{G.show(),p.value=!0;try{const i=await axios.get(`/api/contractors/${v}/check`);i.data.success?q.create({message:i.data.message,color:"green",timeout:2e3}):q.create({message:"Ошибка проверки",color:"red",timeout:2e3})}catch{q.create({message:"Ошибка проверки",color:"red",timeout:2e3})}p.value=!1,G.hide()};return ke(()=>{b(),u()}),(i,e)=>{const w=Ce("router-link");return Se(),Ve(Be,{class:"bg-grey-3"},{default:_(()=>[s("div",Ie,[s("div",Me,[s("p",Fe,[n(w,{to:{name:"ContractorShow",params:{id:Qe(v)}},custom:""},{default:_(({navigate:o})=>[s("div",{onClick:o,class:"cursor-pointer"},[n(Oe,{size:"sm",name:"keyboard_arrow_left"}),e[6]||(e[6]=E(" Назад "))],8,ze)]),_:1},8,["to"])]),s("div",Le,[e[9]||(e[9]=s("div",{class:"row justify-center"},[s("span",{class:"text-h6"}," Информация о контрагенте ")],-1)),s("div",Re,[s("div",We," Имя контрагента: "+$(c.value.full_name),1),s("div",$e," ИНН контрагента: "+$(c.value.inn_kpp),1),s("div",null,[n(j,{class:"q-my-sm q-mr-sm q-px-sm",dense:"","no-caps":"",size:"md",label:"Проверить",icon:"assignment_turned_in",onClick:k,color:"primary"},{default:_(()=>[n(Y,null,{default:_(()=>e[7]||(e[7]=[E(" Проверить операции контрагента ")])),_:1})]),_:1}),n(j,{class:"q-my-sm q-px-md",dense:"","no-caps":"",size:"md",label:"Создать",icon:"add_circle_outline",onClick:k,color:"primary"},{default:_(()=>[n(Y,null,{default:_(()=>e[8]||(e[8]=[E(" Создать новую операцию ")])),_:1})]),_:1})])])]),s("div",Ge,[s("div",Je,[e[10]||(e[10]=s("p",{class:"text-h6 text-center"}," Операции контрагента ",-1)),s("div",Ke,[n(P,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:t.value.dateAt,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.dateAt=o),label:"Дата",type:"date"},null,8,["modelValue"]),n(P,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:t.value.categoryQuery,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.categoryQuery=o),label:"Категории"},null,8,["modelValue"]),n(P,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:t.value.purposeQuery,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.purposeQuery=o),label:"Назначение"},null,8,["modelValue"])]),s("div",Xe,[n(P,{class:"col-2 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:t.value.dateFrom,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.dateFrom=o),label:"Дата начала",type:"date"},null,8,["modelValue"]),n(P,{class:"col-2 q-px-sm",dense:"",clearable:"",outlined:"",filled:"",modelValue:t.value.dateTo,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.dateTo=o),label:"Дата окончания",type:"date"},null,8,["modelValue"])]),s("div",Ye,[n(j,{class:"text-right",dense:"",size:"sm",onClick:u,label:"Применить фильтры",color:"primary"})])]),n(De,{operations:y.value,pagination:r.value,"onUpdate:pagination":e[5]||(e[5]=o=>{r.value=o,u()}),onRefresh:u},null,8,["operations","pagination"])])])])]),_:1})}}};export{lt as default};
