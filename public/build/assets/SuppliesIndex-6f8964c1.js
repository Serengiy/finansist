import{r as w,o,c as L,w as n,u as se,Q as ae,a as t,d,t as y,s as te,i as v,j as oe,h as le,k as A,x as re,y as ne,z as ie,L as ce,B as de,C as ue,n as r,F as f,q as i,b as pe,f as me,D as _e,v as g,H as fe,I as F,P as c,J as Q,N as x}from"./app-64dafc3a.js";import{Q as J}from"./QSpace-767f85f1.js";import{Q as K}from"./QTooltip-3ff6951b.js";import{Q as ge}from"./QExpansionItem-3bf5a263.js";import{Q as ve,a as ye}from"./QTable-9f10ca35.js";import{Q as O}from"./QPagination-9c29fd07.js";import{Q as he}from"./QForm-db958e76.js";import{C as we}from"./ClosePopup-9fac0edc.js";import{u as H}from"./use-dialog-plugin-component-00e1baf8.js";import{_ as ke}from"./_plugin-vue_export-helper-c27b6911.js";import{h as T}from"./html2pdf-792bb947.js";import{I as xe}from"./InfoDialong-683d1c5a.js";import"./position-engine-f936ecea.js";import"./QSelect-fcdeceb1.js";import"./QChip-18101fab.js";import"./QSlideTransition-5ec42607.js";const be={class:"text-center"},Ce={class:"text-center q-mt-lg"},Qe={__name:"ConfirmationDialog",props:["supply_id","note"],emits:[...H.emits],setup(D){w();const b=D,{dialogRef:k,onDialogHide:h,onDialogOK:p,onDialogCancel:C}=H();function m(){p({supply_id:b.supply_id})}return(q,V)=>(o(),L(ae,{ref_key:"dialogRef",ref:k,onHide:se(h)},{default:n(()=>[t(A,{class:"dialog q-pa-lg"},{default:n(()=>[d("h5",be,y(b.note),1),t(he,{onSubmit:m},{default:n(()=>[t(te,{inset:""}),d("div",Ce,[t(v,{color:"green",label:"OK",type:"submit",unelevated:"",class:"q-mr-sm"}),oe(t(v,{color:"red",label:"Отмена",unelevated:"",class:"q-ml-sm"},null,512),[[we]])]),t(le,{class:"justify-center"},{default:n(()=>[t(J)]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}},U=ke(Qe,[["__scopeId","data-v-c33af30c"]]),De={class:""},qe={key:3},Ve={key:4,class:"text-center"},Pe=["onClick"],$e={key:0,class:"text-center"},Ie={key:1,class:"row justify-center"},Se={key:2,class:"row justify-center text-center"},Re={key:0,class:"text-center"},je=d("span",{class:"text-body2"}," Комплектует все заказы по коробам ",-1),Be={key:1,class:"text-center"},Ne=d("span",{class:"text-body2"}," Отправляет поставку в доставку ",-1),ze={key:2,class:"text-center"},Ee={class:""},Fe={class:"flex flex-center"},Ke={class:"flex flex-center"},ts={__name:"SuppliesIndex",setup(D){re();const b=ne();ie("auth");const k=w(),h=w({supply_id:null}),p=async a=>{c.show();try{const s=await axios.get("/api/supplies",{params:{...h.value,page:a}});k.value=s.data.data,m.value=s.data.current_page,C.value=s.data.last_page}catch(s){console.error(s)}c.hide()};ce(()=>{b.name=="SuppliesIndex"&&p()});const C=w(0),m=w(0),q=w({});de(m,a=>{p(a)});const V={rowsNumber:50},G=()=>{h.value={...q.value},m.value=1,p()},M=a=>{Q.create({component:U,componentProps:{supply_id:a,note:"Отправить поставку?"}}).onOk(async s=>{c.show();try{const l=await axios.get(`/api/supplies/submit/${s.supply_id}`);l.data.error&&x.create({message:"Проблемы с передачей в доставку",color:"red"}),l.data.success&&(x.create({message:"Поставка передана в доставку",color:"green"}),p())}catch(l){console.log(l)}c.hide()})},W=a=>{Q.create({component:U,componentProps:{supply_id:a,note:"Собрать поставку?"}}).onOk(async s=>{c.show();try{const l=await axios.get(`/api/supplies/pack/${s.supply_id}`);l.data.error&&x.create({message:l.data.error,color:"red"}),l.data.success&&(x.create({message:"Товары упакованы в поставку",color:"green"}),p())}catch(l){console.log(l)}c.hide()})},X=async a=>{c.show();try{await axios.get(`/api/supplies/supply-qr/${a}`).then(s=>{if(s.data.error)x.create({message:s.data.error,color:"red"});else{let l="data:image/png;base64,"+s.data.supply,u=document.createElement("img");u.src=l,u.style.width="150px",u.style.height="100px",T(u,{filename:"Поставка: "+a,html2canvas:{width:190,height:190,scale:4,letterRendering:!0,x:-13,y:-4},jsPDF:{unit:"mm",format:[60,60]}})}})}catch(s){console.log(s)}c.hide()},Y=async a=>{c.show();try{(await axios.get(`/api/supplies/box-qr/${a}`)).data.qrs.forEach(u=>{console.log(u);const e=document.createElement("img");e.src="data:image/png;base64,"+u,e.width=160,T(e,{filename:a,html2canvas:{width:190,height:190,scale:4,letterRendering:!0,x:-13,y:-4},jsPDF:{unit:"mm",format:[60,60]}})})}catch(s){console.log(s)}c.hide()},Z=async a=>{c.show();try{const s=await axios.get("https://dyatlovait.ru/api/users/"+a),l=await s.data;console.log(s.data),Q.create({component:xe,componentProps:{title:"Ответственный за поставку:",info:l==null?void 0:l.fi}})}catch(s){console.log(s)}c.hide()},ee=[{label:"Номер поставки",name:"supply_id",field:"supply_id",sortable:!1,align:"left"},{label:"Магазины",name:"shops",field:a=>a.reserves,sortable:!1,align:"left"},{label:"Кол-во товаров",name:"orders_count",field:a=>a.reserves,sortable:!1,align:"left"},{label:"Дата поставки",name:"due_date",field:a=>a.reserves,sortable:!1,align:"left"},{label:"Статус",name:"reserve_status",field:a=>a.reserves,sortable:!1,align:"center"},{label:"Ответственный",name:"responsible",field:a=>a.reserves,sortable:!1,align:"center"},{label:"Действия",name:"actions",field:a=>a.reserves,sortable:!1,align:"center"}];return(a,s)=>{var u;const l=ue("router-link");return o(),r(f,null,[t(A,null,{default:n(()=>[t(pe,{class:"row q-gutter-sm justify-between items-start"},{default:n(()=>[d("div",De,[t(me,{class:"col-1",modelValue:h.value.supply_id,"onUpdate:modelValue":s[0]||(s[0]=e=>h.value.supply_id=e),clearable:"",dense:"","hide-details":"",label:"Номер поставки",outlined:"",onKeypress:_e(p,["enter"])},null,8,["modelValue"])]),t(J),t(v,{color:"green",outlined:"",onClick:p},{default:n(()=>[g("Искать")]),_:1}),t(v,{color:"red",outlined:"",onClick:G},{default:n(()=>[g("Сбросить")]),_:1})]),_:1})]),_:1}),(u=k.value)!=null&&u.length?(o(),r(f,{key:0},[t(ve,{columns:ee,pagination:V,rows:k.value,dense:"","hide-bottom":"","row-key":"id",title:"Характеристики","virtual-scroll":"","wrap-cells":""},{"body-cell":n(e=>[t(ye,{class:fe(e.row.is_wrong?"bg-red-2":e.row.is_validated?"bg-green-2":""),item:e},{default:n(()=>{var P,$,I,S,R,j,B,N,z;return[e.col.name=="supply_id"?(o(),r(f,{key:0},[((P=e.row.reserves[0])==null?void 0:P.reserve_status)=="in_process"?(o(),r(f,{key:0},[g(y(e.row.supply_id),1)],64)):(o(),L(l,{key:1,to:{name:"SuppliesCourierShow",params:{supplyId:e.row.supply_id}}},{default:n(()=>[g(y(e.row.supply_id),1)]),_:2},1032,["to"]))],64)):i("",!0),e.col.name=="shops"?(o(!0),r(f,{key:1},F(e.row.reserves,_=>(o(),r("div",null,y(_.shop),1))),256)):i("",!0),e.col.name=="orders_count"?(o(!0),r(f,{key:2},F(e.row.reserves,_=>(o(),r("div",null,y(_.orders_count),1))),256)):i("",!0),e.col.name=="due_date"?(o(),r("div",qe,y(($=e.row.reserves[0])==null?void 0:$.due_date),1)):i("",!0),e.col.name=="responsible"?(o(),r("div",Ve,[d("a",{href:"#",onClick:_=>{var E;return Z((E=e.row.reserves[0])==null?void 0:E.responsible)}},y((I=e.row.reserves[0])==null?void 0:I.responsible),9,Pe)])):e.col.name=="reserve_status"?(o(),r(f,{key:5},[((S=e.row.reserves[0])==null?void 0:S.reserve_status)=="in_process"?(o(),r("div",$e," В процессе сборки ")):i("",!0),((R=e.row.reserves[0])==null?void 0:R.reserve_status)=="packed"?(o(),r("div",Ie," Собрано ")):i("",!0),((j=e.row.reserves[0])==null?void 0:j.reserve_status)=="done"?(o(),r("div",Se," Отправлено ")):i("",!0)],64)):e.col.name=="actions"?(o(),r(f,{key:6},[((B=e.row.reserves[0])==null?void 0:B.reserve_status)=="in_process"?(o(),r("div",Re,[t(v,{onClick:_=>W(e.row.supply_id),size:"sm",color:"yellow",class:"text-black"},{default:n(()=>[g("Собрать "),t(K,{anchor:"top end","max-width":"200px",self:"bottom middle"},{default:n(()=>[je]),_:1})]),_:2},1032,["onClick"])])):i("",!0),((N=e.row.reserves[0])==null?void 0:N.reserve_status)=="packed"?(o(),r("div",Be,[t(v,{class:"",onClick:_=>M(e.row.supply_id),size:"sm",color:"green"},{default:n(()=>[g("Отправить "),t(K,{anchor:"top end","max-width":"200px",self:"bottom middle"},{default:n(()=>[Ne]),_:1})]),_:2},1032,["onClick"])])):i("",!0),((z=e.row.reserves[0])==null?void 0:z.reserve_status)=="delivering"?(o(),r("div",ze,[t(ge,{dense:"",label:"Наклейки",style:{"max-width":"200px"}},{default:n(()=>[d("div",Ee,[d("div",null,[t(v,{class:"full-width",onClick:_=>Y(e.row.supply_id),color:"teal-7",dense:"",size:"sm"},{default:n(()=>[g("QR-короба")]),_:2},1032,["onClick"])]),d("div",null,[t(v,{class:"full-width q-mt-sm",onClick:_=>X(e.row.supply_id),color:"blue-7",dense:"",size:"sm"},{default:n(()=>[g("QR поставки")]),_:2},1032,["onClick"])])])]),_:2},1024)])):i("",!0)],64)):i("",!0)]}),_:2},1032,["class","item"])]),_:1},8,["rows"]),d("div",Fe,[t(O,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=e=>m.value=e),max:C.value,"max-pages":6,"boundary-links":"","boundary-numbers":"",class:"q-mt-md","direction-links":""},null,8,["modelValue","max"])]),d("div",Ke,[t(O,{modelValue:m.value,"onUpdate:modelValue":s[2]||(s[2]=e=>m.value=e),"boundary-links":!1,"direction-links":!1,max:C.value,"max-pages":6,class:"q-mt-md",input:""},null,8,["modelValue","max"])])],64)):i("",!0)],64)}}};export{ts as default};
